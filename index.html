<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innioasis Y1 Rockbox and Firmware Updates - Download Manufacturer & Rockbox Firmware</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Download manufacturer and Rockbox firmware for the Innioasis Y1 music player. Compatible with Innioasis Updater, SP Flash Tool, and MTKclient on Windows, Mac, and Linux. Easy firmware installation and updates.">
    <meta name="keywords" content="Innioasis Y1, Y1 firmware, Rockbox firmware, Innioasis firmware, Y1 updates, firmware download, Innioasis Updater, SP Flash Tool, MTKclient, Y1 music player, firmware installation, Windows, Mac, Linux, Y1 ROM, update.zip, rom.zip">
    <meta name="author" content="Y1 Community">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://innioasis.app/firmware.html">
    <meta property="og:title" content="Innioasis Y1 Rockbox and Firmware Updates">
    <meta property="og:description" content="Download manufacturer and Rockbox firmware for the Innioasis Y1 music player. Compatible with Innioasis Updater, SP Flash Tool, and MTKclient.">
    <meta property="og:image" content="https://innioasis.app/mtkclient/gui/images/icon.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://innioasis.app/firmware.html">
    <meta property="twitter:title" content="Innioasis Y1 Firmware Updates">
    <meta property="twitter:description" content="Download manufacturer and Rockbox firmware for the Innioasis Y1 music player. Compatible with Innioasis Updater, SP Flash Tool, and MTKclient.">
    <meta property="twitter:image" content="https://innioasis.app/mtkclient/gui/images/icon.png">
    
    <!-- Additional SEO -->
    <link rel="canonical" href="https://innioasis.app/firmware.html">
    <meta name="theme-color" content="#007aff">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Light mode colors */
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f7;
            --bg-tertiary: #fafafa;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --text-tertiary: #6e6e73;
            --accent-primary: #007aff;
            --accent-secondary: #5856d6;
            --accent-success: #34c759;
            --accent-warning: #ff9500;
            --accent-error: #ff3b30;
            --border-primary: #d2d2d7;
            --border-secondary: #e5e5e7;
            --shadow-primary: rgba(0, 0, 0, 0.1);
            --shadow-secondary: rgba(0, 0, 0, 0.05);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            position: relative;
        }

        .get-started-btn {
            background: #495057;
            border: none;
            color: white;
            padding: 14px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .get-started-btn:hover {
            background: #343a40;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .get-started-btn img {
            width: 24px;
            height: 24px;
            border-radius: 6px;
        }

        .btn-text-wrapper {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 2px;
        }

        .btn-subtitle {
            font-size: 0.7rem;
            font-weight: 400;
            opacity: 0.85;
            line-height: 1;
        }

        .btn-subtitle a {
            color: inherit;
            text-decoration: underline;
            text-decoration-style: dotted;
        }

        .btn-subtitle a:hover {
            text-decoration-style: solid;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(15px);
            font-weight: 600;
            min-width: 100px;
            justify-content: center;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .theme-toggle .icon {
            font-size: 1.1rem;
        }

        .header-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            transition: transform 0.3s ease;
        }

        .header-icon:hover {
            transform: scale(1.05);
        }

        .header-text {
            flex: 1;
            min-width: 300px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 8px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
        }

        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .header-logos {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo-separator {
            width: 2px;
            height: 40px;
            background: #000000;
        }

        .innioasis-logo {
            height: 40px;
            width: auto;
            transition: transform 0.3s ease;
        }

        .innioasis-logo:hover {
            transform: scale(1.05);
        }

        .innioasis-logo-link {
            text-decoration: none;
            display: inline-block;
            line-height: 0;
        }

        .collaboration-text {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 600;
            font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
        }

        .logo-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .updater-with-icon {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            white-space: nowrap;
            text-decoration: none;
            color: inherit;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            transition: opacity 0.2s ease;
        }

        .updater-with-icon:hover {
            opacity: 0.8;
        }

        /* Override gradient on colored backgrounds */
        .btn-subtitle .updater-with-icon,
        .rom-download-btn .updater-with-icon,
        .update-download-btn .updater-with-icon {
            background: none;
            -webkit-background-clip: unset;
            -webkit-text-fill-color: inherit;
            background-clip: unset;
            color: inherit;
        }

        .updater-with-icon img {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            vertical-align: middle;
        }

        .info-boxes-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 15px;
        }

        .info-box {
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 15px;
            font-size: 0.9rem;
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .info-box h2 {
            color: var(--text-primary);
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .info-box h2:not(:first-of-type) {
            margin-top: 20px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted #6c757d;
            cursor: pointer;
            color: #495057;
            font-weight: 600;
        }

        .tooltip:hover {
            border-bottom-style: solid;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 320px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 8px;
            padding: 12px 14px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -160px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            line-height: 1.6;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            pointer-events: auto;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .tooltip .tooltiptext a {
            color: #86a1ff !important;
            text-decoration: underline;
        }

        .tooltip .tooltiptext a:hover {
            color: #a5baff !important;
        }

        .tooltip:hover .tooltiptext,
        .tooltip.active .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .tooltip .tooltiptext {
                width: 220px;
                margin-left: -110px;
                font-size: 0.75rem;
            }
        }

        .tool-link {
            color: #495057;
            text-decoration: none;
            font-weight: 600;
            transition: opacity 0.2s ease;
        }

        .tool-link:hover {
            opacity: 0.7;
            text-decoration: underline;
        }

        .theme-button-container {
            margin: 8px 0;
        }

        .theme-button {
            display: block;
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 2px solid var(--border-primary);
            border-radius: 10px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: left;
            cursor: pointer;
            border: none;
        }

        .theme-button:hover {
            background: var(--bg-tertiary);
            border: 2px solid #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .theme-button-title {
            display: block;
            font-size: 0.9rem;
            font-weight: 700;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .theme-button-description {
            display: block;
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .theme-install-instructions {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease, margin 0.3s ease;
            padding: 0 16px;
            background: var(--bg-tertiary);
            border-radius: 0 0 10px 10px;
            margin-top: 0;
        }

        .theme-install-instructions.expanded {
            max-height: 200px;
            padding: 12px 16px;
            margin-top: 4px;
            border: 2px solid var(--border-primary);
            border-radius: 10px;
        }

        .theme-install-instructions p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.6;
        }

        .main-content {
            background: var(--bg-secondary);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 8px 32px var(--shadow-primary);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-secondary);
        }

        .prerelease-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: normal;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .prerelease-toggle.ready {
            opacity: 1;
        }

        .prerelease-toggle.disabled {
            cursor: not-allowed;
            opacity: 0.55;
        }

        .prerelease-toggle input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .prerelease-toggle.disabled input {
            cursor: not-allowed;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 25px;
            background: var(--bg-primary);
            border-radius: 20px;
            border: 1px solid var(--border-secondary);
            box-shadow: 0 4px 16px var(--shadow-secondary);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            letter-spacing: -0.01em;
        }

        .filter-group select {
            padding: 12px 16px;
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .refresh-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            align-self: end;
            font-size: 0.9rem;
            font-family: inherit;
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .firmware-list {
            background: var(--bg-primary);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--border-secondary);
            box-shadow: 0 4px 16px var(--shadow-secondary);
        }

        .firmware-list h3 {
            margin-bottom: 20px;
            color: var(--text-primary);
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .firmware-item {
            background: white;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 12px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .firmware-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .firmware-item.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
        }

        .firmware-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
        }

        /* Pill styles for version designations */
        .version-pills {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .version-pill {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .version-pill.ipod-theme {
            background: #007aff;
            color: white;
        }
        
        .version-pill.ipod-theme::before {
            content: "âœ… ";
            margin-right: 4px;
        }

        .version-pill.resolution-360p {
            background: #ffd700;
            color: #1d1d1f;
        }

        .version-pill.nightly {
            background: #ff9500;
            color: white;
        }

        .version-pill.wifi {
            background: #34c759;
            color: white;
        }

        .version-pill.bluetooth {
            background: #007aff;
            color: white;
        }

        .version-pill.usb {
            background: #8e8e93;
            color: white;
        }

        .version-pill.ethernet {
            background: #5856d6;
            color: white;
        }

        .version-pill.hdmi {
            background: #ff3b30;
            color: white;
        }

        .version-pill.audio {
            background: #af52de;
            color: white;
        }

        .version-pill.video {
            background: #ff2d92;
            color: white;
        }

        .version-pill.camera {
            background: #ff9500;
            color: white;
        }

        .version-pill.gps {
            background: #32d74b;
            color: white;
        }

        .version-pill.nfc {
            background: #5ac8fa;
            color: white;
        }

        .version-pill.lte {
            background: #ffcc00;
            color: #000000;
        }

        .version-pill.generic {
            background: #8e8e93;
            color: white;
        }

        /* Scrolling text animation for long version names */
        .detail-value.scroll-text {
            white-space: nowrap;
            animation: scrollText 10s linear infinite;
            cursor: pointer;
            position: relative;
            display: inline-block;
            max-width: 200px;
            overflow: hidden;
        }

        .detail-value.scroll-text:hover {
            animation-play-state: paused;
            white-space: normal;
            overflow: visible;
            max-width: none;
        }

        /* Touch devices - pause animation on touch */
        .detail-value.scroll-text:active {
            animation-play-state: paused;
        }

        @keyframes scrollText {
            0% {
                transform: translateX(0);
            }
            20% {
                transform: translateX(0);
            }
            80% {
                transform: translateX(calc(-100% + 200px));
            }
            100% {
                transform: translateX(calc(-100% + 200px));
            }
        }

        /* Pause animation when user is interacting */
        .firmware-item:hover .scroll-text {
            animation-play-state: paused;
        }

        /* Ensure detail items have proper width constraints */
        .detail-item {
            display: flex;
            flex-direction: column;
            min-width: 0;
            max-width: 250px;
        }

        .detail-value {
            word-break: break-word;
            overflow-wrap: break-word;
        }


        .firmware-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.75rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .detail-value {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }

        .download-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        .download-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .download-section {
            display: flex;
            flex-direction: row;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .btn-subtitle {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.85);
            font-weight: 400;
            line-height: 1.2;
        }

        .btn-subtitle a {
            color: inherit;
            text-decoration: underline;
            text-decoration-style: dotted;
        }

        .btn-subtitle a:hover {
            text-decoration-style: solid;
        }

        .get-updater-link {
            color: #495057;
            text-decoration: none;
            font-size: 0.95rem;
            font-weight: 700;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: rgba(108, 117, 125, 0.1);
            border-radius: 6px;
        }

        .get-updater-link .updater-with-icon {
            background: none !important;
            -webkit-background-clip: unset !important;
            -webkit-text-fill-color: currentColor !important;
            background-clip: unset !important;
            color: currentColor !important;
            font-weight: inherit !important;
        }

        .get-updater-link .updater-with-icon img {
            filter: none !important;
        }

        .get-updater-link:hover {
            color: white;
            background: #6c757d;
            text-decoration: none;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .get-updater-link:hover .updater-with-icon {
            color: white !important;
        }

        body[data-theme="dark"] .get-updater-link {
            color: #adb5bd;
            background: rgba(173, 181, 189, 0.15);
        }

        body[data-theme="dark"] .get-updater-link:hover {
            color: white;
            background: #6c757d;
        }

        body[data-theme="dark"] .get-updater-link:hover .updater-with-icon {
            color: white !important;
        }

        .methods-separator {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 16px 0 12px 0;
            color: #6c757d;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .methods-separator::before,
        .methods-separator::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--border-secondary);
        }

        .methods-separator:not(:empty)::before {
            margin-right: 12px;
        }

        .methods-separator:not(:empty)::after {
            margin-left: 12px;
        }

        .installation-methods {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 8px;
            font-size: 0.85rem;
        }

        .method-link {
            color: #495057;
            text-decoration: none;
            padding: 6px 12px;
            background: rgba(108, 117, 125, 0.08);
            border-radius: 4px;
            transition: all 0.2s ease;
            font-weight: 600;
            position: relative;
            cursor: pointer;
        }

        .method-link:hover {
            background: rgba(108, 117, 125, 0.15);
        }

        .method-link.tooltip {
            border-bottom: none;
        }

        .method-link .tooltiptext {
            bottom: 110%;
            width: 380px;
            margin-left: -190px;
            left: 50%;
            font-weight: 400;
            font-size: 0.82rem;
            line-height: 1.6;
            max-height: 80vh;
            overflow-y: auto;
        }

        .method-link .tooltiptext code {
            display: block;
            margin: 4px 0;
            word-break: break-all;
            white-space: pre-wrap;
        }

        .method-link .tooltiptext a,
        .toolkit-info .tooltiptext a,
        .fast-update-pill .tooltiptext a {
            color: #86a1ff !important;
            text-decoration: underline;
            cursor: pointer;
            pointer-events: auto;
        }

        .method-link .tooltiptext a:hover,
        .toolkit-info .tooltiptext a:hover,
        .fast-update-pill .tooltiptext a:hover {
            color: #a5baff !important;
        }

        @media (max-width: 768px) {
            .method-link .tooltiptext {
                width: 300px;
                margin-left: -150px;
                font-size: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            .method-link .tooltiptext {
                width: 280px;
                margin-left: -140px;
                font-size: 0.72rem;
            }
        }

        .toolkit-info {
            color: #6c757d;
            font-size: 0.85rem;
            font-weight: 500;
            font-style: italic;
            cursor: help;
            position: relative;
            padding: 0;
            background: none;
        }

        .toolkit-info:hover {
            color: #495057;
            background: none;
        }

        .toolkit-info.tooltip {
            border-bottom: none;
        }

        .toolkit-info .tooltiptext {
            bottom: 110%;
            width: 300px;
            margin-left: -150px;
            left: 50%;
            font-weight: 400;
            font-size: 0.85rem;
            line-height: 1.7;
            font-style: normal;
        }

        @media (max-width: 768px) {
            .toolkit-info .tooltiptext {
                width: 260px;
                margin-left: -130px;
            }
        }

        .fast-update-pill {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1d1d1f;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 215, 0, 0.3);
            position: relative;
        }

        .fast-update-pill:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
        }

        .fast-update-pill.tooltip {
            border-bottom: none;
        }

        .fast-update-pill .tooltiptext {
            bottom: 130%;
            width: 280px;
            margin-left: -140px;
            font-weight: 400;
        }

        @media (max-width: 768px) {
            .fast-update-pill .tooltiptext {
                width: 240px;
                margin-left: -120px;
            }
        }

        .whats-new-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .whats-new-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
            background: #5a6268;
        }

        .download-rom-btn {
            background: #6c757d;
            color: white;
            border: 1px solid #5a6268;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .download-rom-btn:hover {
            background: #5a6268;
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Unified download button styles */
        .rom-download-btn,
        .update-download-btn,
        .notes-btn {
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .rom-download-btn {
            background: #5a6268;
            padding: 14px 16px;
        }

        .rom-download-btn:hover {
            background: #495057;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .update-download-btn {
            background: #6c757d;
        }

        .update-download-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .notes-btn {
            background: #6c757d;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 12px 16px;
        }

        .notes-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .status {
            text-align: center;
            padding: 8px 12px;
            background: transparent;
            border-radius: 6px;
            margin-bottom: 12px;
            border: none;
            font-size: 0.9rem;
            opacity: 0.7;
            color: var(--text-secondary);
        }

        .status.error {
            background: rgba(255, 59, 48, 0.1);
            color: var(--accent-error);
            opacity: 1;
        }

        .status.loading {
            background: rgba(255, 149, 0, 0.1);
            color: var(--accent-warning);
            opacity: 1;
        }
        

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6c757d 0%, #495057 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: var(--text-primary);
            opacity: 0.8;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-primary);
        }

        .footer a {
            color: var(--accent-primary);
            text-decoration: none;
            transition: opacity 0.3s ease;
        }

        .footer a:hover {
            text-decoration: underline;
            opacity: 1;
        }



        /* Platform-specific dialog styles */
        .platform-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 2000;
            max-width: 500px;
            width: 90%;
            text-align: center;
            display: none;
        }

        .platform-dialog.show {
            display: block;
        }

        .platform-dialog h3 {
            color: #e74c3c;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .platform-dialog p {
            margin-bottom: 20px;
            line-height: 1.6;
            color: var(--text-primary);
        }

        .platform-dialog .btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .platform-dialog .btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .platform-dialog .btn-secondary {
            background: #6c757d;
        }

        .platform-dialog .btn-secondary:hover {
            background: #5a6268;
        }

        /* Platform Guides Grid */
        .platform-guides-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .platform-guide-btn {
            padding: 15px 10px;
            font-size: 0.9rem;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1999;
            display: none;
        }

        .dialog-overlay.show {
            display: block;
        }

        /* Command box styles */
        .command-box {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 16px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
        }

        .command-box code {
            background: var(--bg-primary);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-secondary);
            font-size: 0.9rem;
            color: var(--text-primary);
            flex: 1;
            word-break: break-all;
        }

        .copy-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .copy-btn:hover {
            background: var(--accent-secondary);
            transform: translateY(-1px);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            
            .container {
                padding: 10px;
            }

            .info-boxes-container {
                grid-template-columns: 1fr;
                padding: 0 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
            }

            .header-logos {
                gap: 12px;
            }
            
            .header-icon {
                width: 60px;
                height: 60px;
            }

            .innioasis-logo {
                height: 32px;
            }
            
            .logo-separator {
                height: 32px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .filters {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .firmware-details {
                grid-template-columns: 1fr;
            }
            
            /* Mobile-specific scrolling text improvements */
            .detail-value.scroll-text {
                animation-duration: 6s; /* Faster on mobile */
                touch-action: pan-x; /* Allow horizontal scrolling on touch */
                max-width: 150px; /* Smaller max width on mobile */
            }
            
            .detail-item {
                max-width: 180px; /* Smaller max width on mobile */
            }
            
        }
        
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .container {
                padding: 8px;
            }
            
            .main-content {
                padding: 15px;
            }
        }

        /* macOS Installation Steps */
        .mac-step {
            text-align: left;
            margin: 20px 0;
        }

        .step-content {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .step-content h4 {
            color: #667eea;
            margin: 0 0 15px 0;
            font-size: 1.2rem;
        }

        .step-content p {
            margin: 12px 0;
            line-height: 1.6;
        }

        .step-content ol {
            margin: 15px 0;
            padding-left: 20px;
        }

        .step-content li {
            margin: 8px 0;
            line-height: 1.5;
        }

        .step-actions {
            margin-top: 25px;
            text-align: center;
        }

        .step-actions .btn {
            margin: 0 10px;
        }

        .alternative-install {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }

        .alternative-link {
            color: #6c757d;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .alternative-link:hover {
            color: #495057;
            text-decoration: underline;
        }

        /* Checklist Styles */
        .checklist {
            margin: 20px 0;
        }

        .checklist-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .checklist-item:hover {
            background: #f1f3f4;
            border-color: #dee2e6;
        }

        .checklist-content h5 {
            margin: 0 0 8px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .checklist-content p {
            margin: 0 0 12px 0;
            color: #6c757d;
            font-size: 0.9rem;
        }

        /* Dark mode support for checklist items */
        body[data-theme="dark"] .checklist-item {
            background: #2c2c2e;
            border-color: #48484a;
        }

        body[data-theme="dark"] .checklist-item:hover {
            background: #3a3a3c;
            border-color: #5a5a5c;
        }

        body[data-theme="dark"] .checklist-content h5 {
            color: #ffffff;
        }

        body[data-theme="dark"] .checklist-content p {
            color: #c7c7cc;
        }

        .checklist-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .info-btn {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .info-btn:hover {
            background: #5a6268;
            transform: scale(1.1);
        }

        .skip-link {
            color: #6c757d;
            text-decoration: none;
            font-size: 0.85rem;
            font-style: italic;
            transition: color 0.3s ease;
        }

        .skip-link:hover {
            color: #495057;
            text-decoration: underline;
        }

        /* Info Modal Styles */
        .info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000001;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .info-modal.show {
            display: flex;
        }

        .info-modal-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .info-modal-close {
            position: absolute;
            top: 12px;
            right: 16px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
        }

        .info-modal h3 {
            margin: 0 0 16px 0;
            color: #2c3e50;
        }

        .info-modal p {
            margin: 0 0 12px 0;
            line-height: 1.6;
        }

        .info-modal .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 12px;
            margin: 16px 0;
        }

        .info-modal .highlight strong {
            color: #856404;
        }

        /* Dark mode support for info modal */
        body[data-theme="dark"] .info-modal-content {
            background: #2c2c2e;
            color: #ffffff;
        }

        /* What's New Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .whats-new-modal {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            max-height: 80vh;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: #2c3e50;
            font-size: 1.3rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #000;
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .release-notes {
            line-height: 1.6;
            color: #333;
        }

        .release-notes h1, .release-notes h2, .release-notes h3 {
            color: #2c3e50;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .release-notes h1 {
            font-size: 1.5rem;
        }

        .release-notes h2 {
            font-size: 1.3rem;
        }

        .release-notes h3 {
            font-size: 1.1rem;
        }

        .release-notes ul {
            padding-left: 20px;
        }

        .release-notes li {
            margin-bottom: 5px;
        }

        .release-notes code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .loading-spinner {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        /* Dark mode support for What's New modal */
        body[data-theme="dark"] .whats-new-modal {
            background: #2c2c2e;
            color: #ffffff;
        }

        body[data-theme="dark"] .modal-header {
            border-bottom-color: #48484a;
        }

        body[data-theme="dark"] .modal-header h3 {
            color: #ffffff;
        }

        body[data-theme="dark"] .close-btn {
            color: #8e8e93;
        }

        body[data-theme="dark"] .close-btn:hover {
            color: #ffffff;
        }

        body[data-theme="dark"] .release-notes {
            color: #ffffff;
        }

        body[data-theme="dark"] .release-notes h1,
        body[data-theme="dark"] .release-notes h2,
        body[data-theme="dark"] .release-notes h3 {
            color: #ffffff;
        }

        body[data-theme="dark"] .release-notes code {
            background: #48484a;
            color: #ffffff;
        }

        body[data-theme="dark"] .info-modal h3 {
            color: #ffffff;
        }

        body[data-theme="dark"] .info-modal p {
            color: #c7c7cc;
        }

        body[data-theme="dark"] .info-modal .highlight {
            background: #3a3a3c;
            border-color: #5a5a5c;
        }

        body[data-theme="dark"] .info-modal .highlight strong {
            color: #ffd700;
        }

        body[data-theme="dark"] .info-modal-close {
            color: #c7c7cc;
        }
    </style>
</head>
<body>
    <!-- Driver Info Modal -->
    <div class="info-modal" id="driverInfoModal">
        <div class="info-modal-content">
            <button class="info-modal-close" onclick="closeDriverInfo()">Ã—</button>
            <h3>ðŸ“¥ MediaTek Driver Installation Info</h3>
            <p>When installing the MediaTek driver, you may see a dialog asking about removing the "origin driver". Here's what to do:</p>
            
            <div class="highlight">
                <strong>Important:</strong> If the installer asks "Remove origin driver?", click <strong>Yes</strong>. This is normal and helps ensure the driver works properly with your Y1 device.
            </div>
            
            <p>This step is necessary because:</p>
            <ul>
                <li>It removes any conflicting drivers that might interfere</li>
                <li>It ensures the MediaTek driver has full control over USB communication</li>
                <li>It prevents driver conflicts that could cause connection issues</li>
            </ul>
            
            <p>After installation, restart your computer as prompted to complete the setup.</p>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="header-logos">
                <img src="mtkclient/gui/images/icon.png" alt="Y1 Helper App Icon" class="header-icon">
                <div class="logo-separator"></div>
                <div class="logo-wrapper">
                    <span class="collaboration-text">In Collaboration With</span>
                    <a href="https://www.innioasis.com" target="_blank" rel="noopener noreferrer" class="innioasis-logo-link">
                        <img src="https://www.innioasis.com/cdn/shop/files/innioasis_540x.jpg?v=1666165346" alt="Innioasis" class="innioasis-logo">
                    </a>
                </div>
            </div>
            <div class="header-text">
                <h1>Y1 Rockbox and Firmware Updates</h1>
                <p>Download manufacturer and Rockbox firmware for Innioasis Y1</p>
                <p style="font-size: 0.85rem; opacity: 0.8; margin-top: 4px;">
                    Compatible with <a href="https://innioasis.app/installguide.html" target="_blank" class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</a>, <a href="https://github.com/rockbox-y1/rockbox#spflash-tool" target="_blank" class="tool-link">SP Flash Tool</a>, and <a href="https://github.com/rockbox-y1/rockbox#mtkclient" target="_blank" class="tool-link">MTKclient</a> on Windows, Mac, and Linux
                </p>
            </div>
            <div style="display: flex; flex-direction: column; gap: 10px; align-items: flex-end;">
                <button class="get-started-btn" onclick="window.open('https://innioasis.app/installguide.html', '_blank')">
                    <img src="mtkclient/gui/images/icon.png" alt="Innioasis">
                    <div class="btn-text-wrapper">
                        <span>Get Updater</span>
                        <span class="btn-subtitle">(incl <a href="https://github.com/rockbox-y1/rockbox#spflash-tool" target="_blank" class="tool-link">SP Flash Tool</a> & <a href="https://github.com/rockbox-y1/rockbox#mtkclient" target="_blank" class="tool-link">MTKClient</a>)</span>
                    </div>
                </button>
                <!-- Theme toggle hidden but still functional in background -->
                <button class="theme-toggle" onclick="toggleTheme()" style="display: none;">
                    <span class="icon">ðŸŒ“</span>
                    <span>Auto</span>
                </button>
            </div>
        </div>

        <div class="main-content">

            <div style="background: var(--bg-secondary); border-radius: 12px; padding: 14px 18px; margin-bottom: 18px; font-size: 0.9rem; color: var(--text-secondary);">
                Simplify music transfers and updates with <strong>Smart Drop</strong> and <strong>âš¡ Fast Drop</strong> in Updater 1.8.2. Coming soon.
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label for="deviceType">Device Type</label>
                    <select id="deviceType">
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="deviceModel">Device Model</label>
                    <select id="deviceModel">
                        <option value="">All Models</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="software">Software</label>
                    <select id="software">
                    </select>
                </div>
            </div>
            

            <div class="status" id="status">
                Ready to download system software
            </div>

            <div class="firmware-list">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 12px;">
                    <h3 id="availableSoftwareTitle" style="margin: 0;">Available System Software</h3>
                    <label id="prereleasesFilterContainer" class="prerelease-toggle disabled">
                        <input type="checkbox" id="showPrereleases">
                        <span id="prereleasesLabelText">Include nightly/beta builds</span>
                    </label>
                </div>
                <div id="firmwareContainer">
                    <p style="text-align: center; color: #6c757d;">Loading firmware...</p>
                </div>
            </div>
        </div>

        <!-- SEO Content Section -->
        <div class="info-boxes-container">
            <div class="info-box">
                <h2>Good to know:</h2>
                <p style="margin-bottom: 12px;">
                    This is where you'll find all the firmware updates for your Y1 music player â€” whether you want the original manufacturer software or custom Rockbox builds. Everything's free to download and comes straight from GitHub.
                </p>
                <p style="margin-bottom: 12px;">
                    <strong>New to this?</strong> If you're using <strong>Windows</strong> or <strong>Mac</strong>, just grab <strong><a href="https://innioasis.app/installguide.html" target="_blank" class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</a></strong> and you're good to go. 
                    It's a simple app that walks you through everything, and it comes with all the tools you need already built in â€” no hunting around for extra downloads.
                </p>
                <h2>Methods and troubleshooting:</h2>
                <p style="margin-bottom: 12px;">
                    <a href="https://innioasis.app/installguide.html" target="_blank" class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</a> automatically lists the latest updates to the Y1 and Rockbox and guides you through its installation, but <strong>alternatively</strong> you can use <a href="https://github.com/rockbox-y1/rockbox#spflash-tool" target="_blank" class="tool-link">SP Flash Tool</a> or <a href="https://github.com/rockbox-y1/rockbox#mtkclient" target="_blank" class="tool-link">MTKClient</a> (both are installed automatically by <a href="https://innioasis.app/installguide.html" target="_blank" class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</a> in <span class="tooltip">Toolkit<span class="tooltiptext">Access <a href="https://github.com/rockbox-y1/rockbox#spflash-tool" target="_blank" class="tool-link" style="color: #adb5bd;">SP Flash Tool</a> and <a href="https://github.com/rockbox-y1/rockbox#mtkclient" target="_blank" class="tool-link" style="color: #adb5bd;">MTKClient</a> by clicking Toolkit in the Updater app (Windows/Mac) or from the Windows Start Menu. There's also a Troubleshooting folder which provides a helpful folder to place the contents of a rom.zip in and click a shortcut to run SP Flash Tool or MTKClient to install or troubleshoot automatically.</span></span>).
                </p>
                <p style="margin-bottom: 12px;">
                    <strong>What you'll download:</strong>
                </p>
                <ul style="margin-left: 20px; margin-bottom: 12px;">
                    <li><strong>rom.zip</strong> â€” The full package for fresh installs or if you need to start over</li>
                    <li><strong>update.zip</strong> â€” Quick updates if you're already running Rockbox (just copy it to your .rockbox folder)</li>
                </ul>
                <p>
                    Whether you're fixing something, trying new features, or just keeping your Y1 up to date â€” we've got you covered.
                </p>
            </div>

            <div class="info-box">
                <h2>Customise your Player:</h2>
                <p style="margin-bottom: 16px;">
                    Make your Y1 truly yours with custom themes! Choose from a variety of options depending on your firmware and resolution.
                </p>

                <div class="theme-button-container">
                    <button class="theme-button" onclick="toggleThemeInstructions('y1-theme')">
                        <span class="theme-button-title">ðŸŽ¨ Y1 Themes Directory</span>
                        <span class="theme-button-description">Works on all ROMs apart from 1.76 Type B Firmwares</span>
                    </button>
                    <div class="theme-install-instructions" id="y1-theme-instructions">
                        <p style="margin-bottom: 8px;"><strong>ðŸ“‚ How to install:</strong> Copy the folder inside the .zip into the Themes folder on your Y1.</p>
                        <a href="https://themes.innioasis.app" target="_blank" rel="noopener noreferrer" style="display: inline-block; padding: 8px 16px; background: #6c757d; color: white; text-decoration: none; border-radius: 6px; font-size: 0.8rem; font-weight: 600; transition: all 0.2s ease;">Get Themes Here â†’</a>
                    </div>
                </div>

                <div class="theme-button-container">
                    <button class="theme-button" onclick="toggleThemeInstructions('rockbox-240p')">
                        <span class="theme-button-title">ðŸŽµ Rockbox 240p Themes</span>
                        <span class="theme-button-description">iPod Classic/Video themes â€” compatible with Y1</span>
                    </button>
                    <div class="theme-install-instructions" id="rockbox-240p-instructions">
                        <p style="margin-bottom: 8px;"><strong>ðŸ“‚ How to install:</strong> Copy the contents of the .rockbox folder from the zip into your Y1's .rockbox folder via USB, overwriting files if asked.</p>
                        <a href="https://themes.rockbox.org/index.php?target=ipodvideo" target="_blank" rel="noopener noreferrer" style="display: inline-block; padding: 8px 16px; background: #6c757d; color: white; text-decoration: none; border-radius: 6px; font-size: 0.8rem; font-weight: 600; transition: all 0.2s ease;">Get Themes Here â†’</a>
                    </div>
                </div>

                <div class="theme-button-container">
                    <button class="theme-button" onclick="toggleThemeInstructions('rockbox-360p')">
                        <span class="theme-button-title">âœ¨ 360p Rockbox Themes</span>
                        <span class="theme-button-description">High-resolution themes made for the Y1's 360p display</span>
                    </button>
                    <div class="theme-install-instructions" id="rockbox-360p-instructions">
                        <p style="margin-bottom: 8px;"><strong>ðŸ“‚ How to install:</strong> Copy the contents of the .rockbox folder from the zip into your Y1's .rockbox folder via USB, overwriting files if asked.</p>
                        <a href="https://github.com/rockbox-y1/themes/releases/latest" target="_blank" rel="noopener noreferrer" style="display: inline-block; padding: 8px 16px; background: #6c757d; color: white; text-decoration: none; border-radius: 6px; font-size: 0.8rem; font-weight: 600; transition: all 0.2s ease;">Get Themes Here â†’</a>
                    </div>
                </div>

                <p style="margin-top: 16px; font-size: 0.85rem; opacity: 0.85;">
                    ðŸ’¡ <strong>Tip:</strong> All these theme directories can also be found in the Toolkit included with <strong><a href="https://innioasis.app/installguide.html" target="_blank" class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</a></strong>.
                </p>
            </div>
        </div>

        <div class="footer">
            <p><a href="https://ko-fi.com/teamslide" target="_blank" style="color: inherit; text-decoration: none;">Made with ðŸ©µ by Y1 users, <u><i>for</i></u> Y1 users</a> | 
               <a href="https://innioasis.app" target="_blank">Innioasis App</a> | 
               <a href="https://innioasis.app" target="_blank">Slidia</a> | 
               <a href="https://reddit.com/r/innioasis" target="_blank">r/Innioasis</a></p>
            <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.7;">ðŸª Cookies not used by this site</p>
        </div>
    </div>


    <!-- Platform-specific dialogs -->
    <div class="dialog-overlay" id="dialogOverlay"></div>
    
    <!-- Windows Dialog -->
    <div class="platform-dialog" id="windowsDialog">
        <h3>ðŸªŸ Windows Installation</h3>
        
        <!-- Step 1: Getting Started -->
        <div class="windows-step" id="windowsStep1">
            <div class="step-content">
                <h4>Getting Started</h4>
                <p>Before we can install the updater, you'll need two drivers so your computer can talk to your Y1 properly:</p>
                
                <div class="checklist">
                    <div class="checklist-item">
                        <div class="checklist-content">
                            <h5>ðŸ“¥ MediaTek Driver</h5>
                            <p>This helps your computer recognize your Y1 device</p>
                            <div class="checklist-actions">
                                <button class="btn btn-primary" onclick="downloadDriver('mtk')">Download MediaTek Driver</button>
                                <button class="info-btn" onclick="showDriverInfo()" title="Important installation info">Help</button>
                                <a href="#" onclick="markDriverComplete(); return false;" class="skip-link">Already done this</a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="step-actions">
                    <button class="btn btn-primary" onclick="nextWindowsStep()">Next â†’</button>
                    <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Step 2: Install & Run -->
        <div class="windows-step" id="windowsStep2" style="display: none;">
            <div class="step-content">
                <h4>Install & Run</h4>
                <p>Now let's get the actual updater app:</p>
                <button class="btn btn-primary" onclick="downloadWindows()">ðŸ“¥ Download Windows Installer</button>
                
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="prevWindowsStep()">â† Back</button>
                    <button class="btn btn-primary" onclick="nextWindowsStep()">Next â†’</button>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Final Steps -->
        <div class="windows-step" id="windowsStep3" style="display: none;">
            <div class="step-content">
                <h4>Almost Done!</h4>
                <p>Here's what to do next:</p>
                <ol>
                    <li>Install the MediaTek driver you downloaded</li>
                    <li>Install <a href="https://innioasis.app/installguide.html" target="_blank" class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</a></li>
                    <li><strong>Restart your computer</strong></li>
                    <li>Launch <a href="https://innioasis.app/installguide.html" target="_blank" class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</a> from the Start Menu</li>
                </ol>
                
                <p><strong>Important:</strong> Don't skip the restart - it makes sure everything works properly!</p>
                
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="prevWindowsStep()">â† Back</button>
                    <button class="btn btn-primary" onclick="closeDialog()">Finish</button>
                </div>
            </div>
        </div>
    </div>

    <!-- macOS Dialog -->
    <div class="platform-dialog" id="macDialog">
        <h3>ðŸŽ macOS Installation</h3>
        
        <!-- Step 1: Prerequisites -->
        <div class="mac-step" id="macStep1">
            <div class="step-content">
                <h4>Prerequisites</h4>
                <p>Before installing <a href="https://innioasis.app/installguide.html" target="_blank" class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</a>, you'll need <a href="https://github.com/Homebrew/brew/releases/latest" target="_blank" class="homebrew-link">Homebrew</a> package manager on your Mac.</p>
                <p>Homebrew helps manage dependencies and ensures everything works smoothly.</p>
                
                <div class="step-actions">
                    <button class="btn btn-primary" onclick="nextMacStep()">Next â†’</button>
                    <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
                </div>
            </div>
        </div>
        
        <!-- Step 2: Download -->
        <div class="mac-step" id="macStep2" style="display: none;">
            <div class="step-content">
                <h4>Download <a href="https://innioasis.app/installguide.html" target="_blank" class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</a></h4>
                <p>Click the button below to download the macOS app package (.dmg file):</p>
                <button class="btn btn-primary" onclick="downloadMacDMG()">ðŸ“¥ Download for Mac</button>
                
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="prevMacStep()">â† Back</button>
                    <button class="btn btn-primary" onclick="nextMacStep()">Next â†’</button>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Installation -->
        <div class="mac-step" id="macStep3" style="display: none;">
            <div class="step-content">
                <h4>Install & Run</h4>
                <p>After downloading:</p>
                <ol>
                    <li>Double-click the .dmg file</li>
                    <li>Drag <a href="https://innioasis.app/installguide.html" target="_blank" class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</a> to your Applications folder</li>
                    <li>Launch the app from Applications</li>
                </ol>
                
                <p><strong>Note:</strong> You may need to <a href="#" id="appleGuideLink" target="_blank" class="apple-guide-link">allow apps from unknown developers</a> in System Preferences.</p>
                
                <div class="step-actions">
                    <button class="btn btn-secondary" onclick="prevMacStep()">â† Back</button>
                    <button class="btn btn-primary" onclick="closeDialog()">Finish</button>
                </div>
            </div>
        </div>
        
        <!-- Alternative Install Method Link -->
        <div class="alternative-install">
            <a href="#" onclick="showMacTerminalInstall(); return false;" class="alternative-link">
                ðŸ”§ Alternative Install Method (Terminal)
            </a>
        </div>
    </div>

    <!-- Linux Dialog -->
    <div class="platform-dialog" id="linuxDialog">
        <h3>ðŸ§ Linux Installation</h3>
        <p>Ubuntu is recommended for the best experience, but other distributions should work as well. Follow the instructions in the new tab to set up the required dependencies.</p>
        <button class="btn" onclick="openLinuxInstructions()">Open Instructions</button>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <!-- ChromeOS/FydeOS Dialog -->
    <div class="platform-dialog" id="chromeosDialog">
        <h3>ðŸ–¥ï¸ ChromeOS/FydeOS</h3>
        <p>You MAY be able to run <a href="https://innioasis.app/installguide.html" target="_blank" class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</a> in Linux mode, but we have not tested this configuration. Follow the Linux instructions in the new tab and try running it in your Linux environment.</p>
        <p><em>Note: This is experimental and may not work as expected.</em></p>
        <button class="btn" onclick="openLinuxInstructions()">View Linux Instructions</button>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <!-- Windows ARM64 Dialog -->
    <div class="platform-dialog" id="windowsArmDialog">
        <h3>ðŸªŸ Windows ARM64</h3>
        <p>For Windows ARM64 users, more advanced users may be able to run the Linux version using Python, Libusb, android-platform-tools, USBIPD-win and WSLg. Ubuntu is recommended.</p>
        <button class="btn" onclick="openLinuxInstructions()">View Linux Instructions</button>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <!-- Platform Guides Dialog -->
    <div class="platform-dialog" id="platformGuidesDialog">
        <h3>ðŸŒ Platform Setup Guides</h3>
        <p>Choose your platform to view detailed setup instructions:</p>
        <div class="platform-guides-grid">
            <button class="btn platform-guide-btn" onclick="navigateToPlatform('windowsDialog')">ðŸªŸ Windows</button>
            <button class="btn platform-guide-btn" onclick="navigateToPlatform('macDialog')">ðŸŽ macOS</button>
            <button class="btn platform-guide-btn" onclick="navigateToPlatform('linuxDialog')">ðŸ§ Linux</button>
        </div>
        <button class="btn btn-secondary" onclick="closeDialog()">Close</button>
    </div>

    <script>
        // Global variables
        let packages = [];
        let currentFilters = {
            deviceType: 'A',
            deviceModel: 'Y1',
            software: 'Original Software',
            showPrereleases: false
        };
        let userPrefersPrereleases = false;

        // Function to toggle theme installation instructions (accordion style)
        function toggleThemeInstructions(themeId) {
            const clickedInstructions = document.getElementById(themeId + '-instructions');
            const allInstructions = document.querySelectorAll('.theme-install-instructions');
            
            // Close all other instructions
            allInstructions.forEach(instructions => {
                if (instructions.id !== themeId + '-instructions') {
                    instructions.classList.remove('expanded');
                }
            });
            
            // Toggle the clicked one
            if (clickedInstructions) {
                clickedInstructions.classList.toggle('expanded');
            }
        }

        // Function to toggle tooltip visibility on click/touch (using event delegation for dynamic content)
        document.addEventListener('DOMContentLoaded', function() {
            // Use event delegation for dynamically added tooltips
            document.body.addEventListener('click', function(e) {
                // Check if we clicked on a link inside a tooltip
                const linkInTooltip = e.target.closest('.tooltiptext a');
                if (linkInTooltip) {
                    // Allow the link to work normally, don't prevent default
                    e.stopPropagation(); // Prevent tooltip from closing
                    return;
                }
                
                // Check if we clicked inside a tooltip text area (but not on a link)
                const insideTooltipText = e.target.closest('.tooltiptext');
                if (insideTooltipText) {
                    // Don't close the tooltip or toggle anything
                    e.stopPropagation();
                    return;
                }
                
                const tooltipElement = e.target.closest('.tooltip');
                
                if (tooltipElement) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Close all other tooltips
                    document.querySelectorAll('.tooltip.active').forEach(t => {
                        if (t !== tooltipElement) {
                            t.classList.remove('active');
                        }
                    });
                    
                    // Toggle this tooltip
                    tooltipElement.classList.toggle('active');
                } else {
                    // Close all tooltips when clicking outside
                    document.querySelectorAll('.tooltip.active').forEach(tooltip => {
                        tooltip.classList.remove('active');
                    });
                }
            });
        });

        // Function to parse version names and extract designations with flexible adjective handling
        function parseVersionDesignations(versionName) {
            const designations = [];
            
            // Define adjectives that can modify their nearest neighbor
            const adjectives = ['compatible', 'aware', 'supported', 'enabled', 'disabled', 'ready', 'optimized', 'enhanced'];
            
            // Extract version number - look for version patterns anywhere in the tag name
            // First remove long hex strings at the end (like -13057e75dc29a1a7!)
            let cleanVersion = versionName.replace(/-[a-f0-9]{16,}!?$/, '');
            // Remove any remaining trailing dashes or exclamation marks
            cleanVersion = cleanVersion.replace(/[-!]+$/, '');
            
            // Initialize extractedVersion to null - we'll set it when we find a valid version
            let extractedVersion = null;
            
            // First, try to find a version pattern anywhere in the tag (e.g., "v0.3", "v1.2.3")
            // This handles cases like "Stable-v0.3-ipod-theme-compatible" where version is in the middle
            const versionPattern = cleanVersion.match(/\bv([\d.]+)\b/i);
            if (versionPattern) {
                extractedVersion = versionPattern[1]; // Extract just the numbers (without "v")
            }
            
            // Fallback: Also check the last part after the last dash (original behavior)
            // This handles cases where version is at the end like "some-tag-v0.3"
            if (!extractedVersion && cleanVersion.includes('-')) {
                let lastPart = cleanVersion.split('-').pop();
                // Strip "v" prefix if present (e.g., "v0.3" -> "0.3")
                if (lastPart.toLowerCase().startsWith('v')) {
                    lastPart = lastPart.substring(1);
                }
                // Check if the last part contains only numbers (and possibly dots)
                if (/^[\d.]+$/.test(lastPart)) {
                    extractedVersion = lastPart;
                }
            }
            
            // Use extracted version if found, otherwise keep the cleaned tag name
            if (extractedVersion) {
                cleanVersion = extractedVersion;
            }
            
            // Parse designations from the original version name
            // Split by dashes and process each part
            const parts = versionName.split('-');
            
            for (let i = 0; i < parts.length; i++) {
                const part = parts[i];
                
                // Skip if it's the version number part
                if (/^[\d.]+$/.test(part)) {
                    continue;
                }
                
                // Skip if it's a hex string
                if (/^[a-f0-9]{16,}!?$/.test(part)) {
                    continue;
                }
                
                // Skip "Type", "B", "Base", and "Stable" as they are used for device type filtering or stability indication, not display
                if (part === 'type' || part === 'b' || part === 'base' || part === 'stable') {
                    continue;
                }
                
                // Handle special cases first
                if (part === 'nightly') {
                    designations.push({
                        type: 'nightly',
                        text: 'Nightly'
                    });
                } else if (part === '360p') {
                    designations.push({
                        type: 'resolution-360p',
                        text: '360p'
                    });
                } else if (part === 'wifi' || part === 'wi-fi') {
                    designations.push({
                        type: 'wifi',
                        text: 'Wi-Fi'
                    });
                } else if (part === 'bluetooth') {
                    designations.push({
                        type: 'bluetooth',
                        text: 'Bluetooth'
                    });
                } else if (part === 'usb') {
                    designations.push({
                        type: 'usb',
                        text: 'USB'
                    });
                } else if (part === 'ethernet') {
                    designations.push({
                        type: 'ethernet',
                        text: 'Ethernet'
                    });
                } else if (part === 'hdmi') {
                    designations.push({
                        type: 'hdmi',
                        text: 'HDMI'
                    });
                } else if (part === 'audio') {
                    designations.push({
                        type: 'audio',
                        text: 'Audio'
                    });
                } else if (part === 'video') {
                    designations.push({
                        type: 'video',
                        text: 'Video'
                    });
                } else if (part === 'camera') {
                    designations.push({
                        type: 'camera',
                        text: 'Camera'
                    });
                } else if (part === 'gps') {
                    designations.push({
                        type: 'gps',
                        text: 'GPS'
                    });
                } else if (part === 'nfc') {
                    designations.push({
                        type: 'nfc',
                        text: 'NFC'
                    });
                } else if (part === 'lte') {
                    designations.push({
                        type: 'lte',
                        text: 'LTE'
                    });
                } else if (part === '5g') {
                    designations.push({
                        type: '5g',
                        text: '5G'
                    });
                } else if (part === 'ipod' && i + 1 < parts.length && parts[i + 1] === 'theme') {
                    // Handle "ipod-theme" case
                    if (i + 2 < parts.length && adjectives.includes(parts[i + 2])) {
                        // Check for adjective after "ipod-theme"
                        const adjective = parts[i + 2];
                        designations.push({
                            type: 'ipod-theme',
                            text: `iPod Themes ${adjective.charAt(0).toUpperCase() + adjective.slice(1)}`
                        });
                    } else {
                        designations.push({
                            type: 'ipod-theme',
                            text: 'iPod Themes'
                        });
                    }
                } else if (part === 'theme' && i > 0 && parts[i - 1] === 'ipod') {
                    // Skip this as it's handled above
                    continue;
                } else {
                    // Check if this part is followed by an adjective
                    if (i + 1 < parts.length && adjectives.includes(parts[i + 1])) {
                        const adjective = parts[i + 1];
                        // Capitalize the main part and add the adjective
                        const mainPart = part.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                        designations.push({
                            type: 'generic',
                            text: `${mainPart} ${adjective.charAt(0).toUpperCase() + adjective.slice(1)}`
                        });
                    } else {
                        // Just add the part as-is, capitalized
                        if (!adjectives.includes(part)) { // Don't add standalone adjectives
                            designations.push({
                                type: 'generic',
                                text: part.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase())
                            });
                        }
                    }
                }
            }
            
            return {
                cleanVersion: cleanVersion.trim(),
                designations: designations
            };
        }

        // Function to format date in a fancy, simplified way without time
        function formatFancyDate(dateObj) {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            const dateOnly = new Date(dateObj.getFullYear(), dateObj.getMonth(), dateObj.getDate());
            const todayOnly = new Date(today.getFullYear(), today.getMonth(), today.getDate());
            const yesterdayOnly = new Date(yesterday.getFullYear(), yesterday.getMonth(), yesterday.getDate());
            
            if (dateOnly.getTime() === todayOnly.getTime()) {
                return "Today";
            } else if (dateOnly.getTime() === yesterdayOnly.getTime()) {
                return "Yesterday";
            } else {
                const daysDiff = Math.floor((todayOnly - dateOnly) / (1000 * 60 * 60 * 24));
                
                if (daysDiff <= 7) {
                    // Within the last week - show day name
                    return dateObj.toLocaleDateString('en-US', { weekday: 'long' });
                } else if (daysDiff <= 30) {
                    // Within the last month - show month and day
                    return dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                } else {
                    // Older than a month - show month and year
                    return dateObj.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                }
            }
        }

        // Function to get display version - either version number or published date
        function getDisplayVersion(versionInfo, publishedDate) {
            const versionText = versionInfo.cleanVersion;
            
            // If version is longer than 8 characters, use published date instead
            if (versionText.length > 8) {
                if (publishedDate) {
                    try {
                        const dateObj = new Date(publishedDate);
                        return formatFancyDate(dateObj);
                    } catch (e) {
                        return publishedDate;
                    }
                } else {
                    return "Unknown Date";
                }
            }
            
            return versionText;
        }
        

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
            updateAvailableSoftwareTitle(); // Set initial title
            detectUserOS();
            checkSavedTheme();
            
            // Close driver info modal when clicking outside
            document.getElementById('driverInfoModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDriverInfo();
                }
            });
        });

        // Detect user's operating system and update CTA banner
        function detectUserOS() {
            const userAgent = navigator.userAgent;
            let os = 'Windows';
            let isArm64 = false;
            
            if (userAgent.includes('Mac')) {
                os = 'macOS';
            } else if (userAgent.includes('Linux')) {
                os = 'Linux';
            } else if (userAgent.includes('CrOS') || userAgent.includes('FydeOS')) {
                os = 'ChromeOS/FydeOS';
            }
            
            // Check for Windows ARM64
            if (userAgent.includes('Windows') && (userAgent.includes('ARM64') || userAgent.includes('ARM'))) {
                isArm64 = true;
            }
            
            // Store platform info globally
            window.userPlatform = { os, isArm64 };
        }



        // Platform-specific download functions
        function downloadForPlatform() {
            const platform = window.userPlatform;
            
            if (platform.isArm64) {
                showDialog('windowsArmDialog');
            } else if (platform.os === 'Windows') {
                showDialog('windowsDialog');
            } else if (platform.os === 'macOS') {
                showDialog('macDialog');
            } else if (platform.os === 'Linux') {
                showDialog('linuxDialog');
            } else if (platform.os === 'ChromeOS/FydeOS') {
                showDialog('chromeosDialog');
            }
        }

        function downloadWindows() {
            // Download Windows installer
            const url = 'https://github.com/y1-community/Innioasis-Updater/releases/latest/download/Innioasis.Updater.-.Windows.exe';
            
            // For Safari, open in new tab, for other browsers use download attribute
            if (navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome')) {
                window.open(url, '_blank');
                setTimeout(() => {
                    alert('ðŸŽ‰ Opening download page in new tab! Click the download button on the GitHub page.');
                }, 1000);
            } else {
                const link = document.createElement('a');
                link.href = url;
                link.download = 'Innioasis.Updater.-.Windows.exe';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                setTimeout(() => {
                    alert('ðŸŽ‰ Download started! The Windows installer is downloading to your Downloads folder.');
                }, 1000);
            }
            
            // Auto-advance to next step after a short delay
            setTimeout(() => {
                nextWindowsStep();
            }, 1500);
        }

        // Driver Info Modal Functions
        function showDriverInfo() {
            const modal = document.getElementById('driverInfoModal');
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeDriverInfo() {
            const modal = document.getElementById('driverInfoModal');
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }
        }

        // Checklist Functions
        function markDriverComplete() {
            // Mark the driver as complete and move to next step
            const checklistItem = document.querySelector('.checklist-item');
            if (checklistItem) {
                checklistItem.style.opacity = '0.6';
                checklistItem.style.textDecoration = 'line-through';
                checklistItem.querySelector('.checklist-actions').innerHTML = '<span style="color: #28a745; font-weight: bold;">âœ“ Completed</span>';
            }
            
            // Auto-advance to next step after a short delay
            setTimeout(() => {
                nextWindowsStep();
            }, 1500);
        }

        function downloadDriver(driverType) {
            // Only handle MediaTek driver now
            if (driverType === 'mtk') {
                const url = 'https://innioasis.app/driverinstall.exe';
                const filename = 'driver_mtk.exe';
                
                // For Safari, open in new tab, for other browsers use download attribute
                if (navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome')) {
                    window.open(url, '_blank');
                    setTimeout(() => {
                        alert(`ðŸŽ‰ Opening MediaTek driver download page in new tab! Click the download button on the GitHub page.`);
                    }, 1000);
                } else {
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    setTimeout(() => {
                        alert(`ðŸŽ‰ Download started! The MediaTek driver is downloading to your Downloads folder.`);
                    }, 1000);
                }
            }
        }

        function openMacInstructions() {
            window.open('https://github.com/y1-community/Innioasis-Updater#manual-setup', '_blank');
        }

        function copyMacCommand() {
            const command = '/bin/bash -c "$(curl -fsSL https://mac.innioasis.app)"';
            
            if (navigator.clipboard && window.isSecureContext) {
                // Use modern clipboard API
                navigator.clipboard.writeText(command).then(() => {
                    showCopySuccess();
                }).catch(() => {
                    fallbackCopyTextToClipboard(command);
                });
            } else {
                // Fallback for older browsers
                fallbackCopyTextToClipboard(command);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showCopySuccess();
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }
            
            document.body.removeChild(textArea);
        }

        function showCopySuccess() {
            const copyBtn = document.querySelector('.copy-btn');
            const originalText = copyBtn.textContent;
            copyBtn.textContent = 'âœ… Copied!';
            copyBtn.style.background = 'var(--accent-success)';
            
            setTimeout(() => {
                copyBtn.textContent = originalText;
                copyBtn.style.background = 'var(--accent-primary)';
            }, 2000);
        }

        function openLinuxInstructions() {
            window.open('https://github.com/y1-community/Innioasis-Updater#linux---ubuntu-recommended', '_blank');
        }

        function showDialog(dialogId) {
            document.getElementById('dialogOverlay').classList.add('show');
            document.getElementById(dialogId).classList.add('show');
            
            // Update Apple guide link if showing macOS dialog
            if (dialogId === 'macDialog') {
                updateAppleGuideLink();
            }
            
            // Initialize Windows steps if showing Windows dialog
            if (dialogId === 'windowsDialog') {
                // Hide all steps except first
                for (let i = 2; i <= 3; i++) {
                    document.getElementById(`windowsStep${i}`).style.display = 'none';
                }
                document.getElementById('windowsStep1').style.display = 'block';
            }
        }

        function closeDialog() {
            document.getElementById('dialogOverlay').classList.remove('show');
            document.querySelectorAll('.platform-dialog').forEach(dialog => {
                dialog.classList.remove('show');
            });
        }

        // Close dialog when clicking overlay
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('dialogOverlay').addEventListener('click', closeDialog);
            checkSavedTheme();
        });

        function updateAvailableSoftwareTitle() {
            const softwareSelect = document.getElementById('software');
            const titleElement = document.getElementById('availableSoftwareTitle');
            
            if (softwareSelect.value) {
                const selectedText = softwareSelect.options[softwareSelect.selectedIndex].text;
                titleElement.textContent = selectedText;
            } else {
                titleElement.textContent = 'Available System Software';
            }
        }

        function setupEventListeners() {
            document.getElementById('deviceType').addEventListener('change', function() {
                populateSoftwareCombo();
                filterFirmware();
            });
            document.getElementById('deviceModel').addEventListener('change', function() {
                    updateTypeFilterVisibility();
                    populateSoftwareCombo();
                    filterFirmware();
            });
            document.getElementById('software').addEventListener('change', function() {
                updateAvailableSoftwareTitle();
                filterFirmware();
            });
            document.getElementById('showPrereleases').addEventListener('change', function() {
                userPrefersPrereleases = this.checked;
                filterFirmware();
            });
        }

        // Load config.ini tokens for API fallback
        let apiTokens = [];
        
        async function loadConfigTokens() {
            try {
                const response = await fetch('config.ini');
                if (!response.ok) {
                    console.warn('Could not load config.ini, using unauthenticated API calls only');
                    return [];
                }
                
                const configText = await response.text();
                const tokens = [];
                const lines = configText.split('\n');
                
                for (const line of lines) {
                    const trimmed = line.trim();
                    if (trimmed.startsWith('key_') && trimmed.includes('=')) {
                        const token = trimmed.split('=')[1].trim();
                        if (token && token.length > 10) {
                            tokens.push(token);
                        }
                    }
                }
                
                console.log(`Loaded ${tokens.length} API tokens from config.ini`);
                return tokens;
            } catch (error) {
                console.warn('Error loading config.ini:', error);
                return [];
            }
        }

        async function loadData() {
            try {
                setStatus('Loading configuration and manifest data...', 'loading');
                
                // Load API tokens first
                apiTokens = await loadConfigTokens();
                
                // Load manifest data
                const manifestResponse = await fetch('./slidia_manifest.xml');
                if (!manifestResponse.ok) {
                    throw new Error('Failed to load manifest');
                }
                
                const manifestText = await manifestResponse.text();
                packages = parseManifest(manifestText);
                
                if (packages.length === 0) {
                    throw new Error('No packages found in manifest');
                }
                
                console.log(`Loaded ${packages.length} software packages`);
                
                // Populate filters
                populateDeviceTypeCombo();
                populateDeviceModelCombo();
                populateSoftwareCombo();
                
                // Apply default selections
                const deviceTypeSelect = document.getElementById('deviceType');
                const deviceModelSelect = document.getElementById('deviceModel');
                const softwareSelect = document.getElementById('software');
                const prereleaseCheckbox = document.getElementById('showPrereleases');
                
                if (deviceTypeSelect) {
                    deviceTypeSelect.value = currentFilters.deviceType || 'A';
                }
                if (deviceModelSelect) {
                    deviceModelSelect.value = currentFilters.deviceModel || '';
                }
                if (softwareSelect) {
                    softwareSelect.value = currentFilters.software || '';
                }
                if (prereleaseCheckbox) {
                    prereleaseCheckbox.checked = currentFilters.showPrereleases;
                }
                
                updateTypeFilterVisibility();
                updateAvailableSoftwareTitle();
                
                // Apply default filters and load firmware
                filterFirmware();
                
                // Load initial firmware list
                await loadFirmwareList();
                
                setStatus('Ready to download firmware');
                
            } catch (error) {
                console.error('Error loading data:', error);
                setStatus(`Error loading data: ${error.message}`, 'error');
            }
        }

        
        
        
        
        
        
        function parseManifest(xmlText) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            const packageElements = xmlDoc.getElementsByTagName('package');
            
            const packages = [];
            for (let pkg of packageElements) {
                // Skip packages that have a device_type specified in the manifest
                // These are special packages (like "Please Update App To Continue") that shouldn't be shown
                const manifestDeviceType = pkg.getAttribute('device_type') || '';
                if (manifestDeviceType) {
                    console.log(`Skipping package with manifest device_type: ${pkg.getAttribute('name')} (device_type=${manifestDeviceType})`);
                    continue;
                }
                
                packages.push({
                    name: pkg.getAttribute('name') || 'Unknown',
                    device_type: '',  // Device type will be determined from release tags, not manifest
                    repo: pkg.getAttribute('repo') || '',
                    device: pkg.getAttribute('device') || '',
                    url: pkg.getAttribute('url') || '',
                    type: pkg.getAttribute('type') || '',
                    handler: pkg.getAttribute('handler') || ''
                });
            }
            
            return packages;
        }

        function populateDeviceTypeCombo() {
            const combo = document.getElementById('deviceType');
            
            // Always populate with Type A and Type B since we determine this from release tags
            combo.innerHTML = '';
            
            const typeA = document.createElement('option');
            typeA.value = 'A';
            typeA.textContent = 'Type A';
            typeA.selected = true;  // Set Type A as default
            combo.appendChild(typeA);
            
            const typeB = document.createElement('option');
            typeB.value = 'B';
            typeB.textContent = 'Type B';
            combo.appendChild(typeB);
        }

        function populateDeviceModelCombo() {
            const combo = document.getElementById('deviceModel');
            const deviceModels = [...new Set(packages.map(p => p.device).filter(m => m))];
            
            combo.innerHTML = '<option value="">All Models</option>';
            deviceModels.sort().forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                // Set Y1 as default
                if (model && model.toLowerCase().includes('y1')) {
                    option.selected = true;
                }
                combo.appendChild(option);
            });
            
            // Show/hide Type selector based on selected model
            updateTypeFilterVisibility();
        }
        
        function updateTypeFilterVisibility() {
            const selectedModel = document.getElementById('deviceModel').value;
            const typeFilterGroup = document.getElementById('deviceType').closest('.filter-group');
            
            // Only show Type selector when Y1 is selected
            if (selectedModel && selectedModel.toLowerCase().includes('y1')) {
                typeFilterGroup.style.display = '';
            } else {
                typeFilterGroup.style.display = 'none';
            }
        }

        function populateSoftwareCombo() {
            const combo = document.getElementById('software');
            const selectedModel = document.getElementById('deviceModel').value;
            
            // Get filtered software names based on model selection only
            // Type filtering happens at the release level now
            const filteredPackages = packages.filter(package => {
                const modelMatch = !selectedModel || package.device === selectedModel;
                return modelMatch;
            });
            
            const softwareNames = [...new Set(filteredPackages.map(p => p.name).filter(n => n))];
            
            combo.innerHTML = '';
            softwareNames.sort().forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                // Set Original as default
                if (name && name.toLowerCase().includes('original')) {
                    option.selected = true;
                }
                combo.appendChild(option);
            });
        }

        function releaseMatchesTypeFilter(tagName, selectedType) {
            // Check if a release tag matches the selected device type filter
            // This mimics the logic from firmware_downloader.py
            if (!selectedType) {
                return true;
            }
            
            const hasTypeB = tagName.toLowerCase().includes('type-b') || tagName.toLowerCase().includes('-b-');
            
            if (selectedType === 'B') {
                // Type B filter: only show releases with 'type-b' or '-b-' in tag
                return hasTypeB;
            } else {
                // Type A filter: show releases without 'type-b' or '-b-' in tag
                return !hasTypeB;
            }
        }
        
        function filterFirmware() {
            currentFilters.deviceType = document.getElementById('deviceType').value;
            currentFilters.deviceModel = document.getElementById('deviceModel').value;
            currentFilters.software = document.getElementById('software').value;
            currentFilters.showPrereleases = document.getElementById('showPrereleases').checked;
            
            loadFirmwareList();
        }

        function updatePrereleaseToggle(hasPrereleases, allReleases = null) {
            const container = document.getElementById('prereleasesFilterContainer');
            const checkbox = document.getElementById('showPrereleases');
            const labelText = document.getElementById('prereleasesLabelText');

            if (!container || !checkbox || !labelText) {
                return;
            }

            const wasShowingPrereleases = currentFilters.showPrereleases;

            container.classList.add('ready');
            container.classList.toggle('disabled', !hasPrereleases);
            checkbox.disabled = !hasPrereleases;

            // Check if there are any stable releases available
            // Only auto-enable pre-releases if there are NO stable releases
            let hasStable = false;
            if (allReleases && allReleases.length > 0) {
                hasStable = allReleases.some(release => {
                    const tagLower = release.tag_name.toLowerCase();
                    // Skip excluded releases
                    if (tagLower.includes('base')) {
                        return false;
                    }
                    // Check type filter
                    const hasTypeB = tagLower.includes('type-b') || tagLower.includes('-b-');
                    if (currentFilters.deviceType === 'B' && !hasTypeB) {
                        return false;
                    }
                    if (currentFilters.deviceType === 'A' && hasTypeB) {
                        return false;
                    }
                    // Check if it's a pre-release or nightly
                    const hasStableInTag = tagLower.includes('stable');
                    let isPrerelease = release.prerelease || release.draft || 
                                       tagLower.includes('nightly') || 
                                       tagLower.includes('beta');
                    // Releases with "stable" in tag name are always treated as stable
                    if (hasStableInTag) {
                        isPrerelease = false;
                    }
                    // If it's not a pre-release and not nightly, it's stable
                    return !isPrerelease;
                });
            }

            if (hasPrereleases) {
                // Only auto-enable if there are NO stable releases
                // Don't auto-enable if user manually changed the filter (tracked via userPrefersPrereleases)
                const shouldAutoEnable = !hasStable && !wasShowingPrereleases;
                
                if (shouldAutoEnable) {
                    console.log('Auto-enabling pre-releases: only pre-releases available for selected option');
                    checkbox.checked = true;
                    currentFilters.showPrereleases = true;
                    userPrefersPrereleases = true;
                } else if (hasStable) {
                    // There ARE stable releases - don't auto-enable, use user preference
                    console.log('Not auto-enabling pre-releases: found stable releases available');
                    checkbox.checked = userPrefersPrereleases;
                    currentFilters.showPrereleases = userPrefersPrereleases;
                } else {
                    // User preference
                    checkbox.checked = userPrefersPrereleases;
                    currentFilters.showPrereleases = userPrefersPrereleases;
                }
                
                labelText.textContent = 'Include nightly/beta builds';
                if (currentFilters.showPrereleases && !wasShowingPrereleases) {
                    filterFirmware();
                    return;
                }
            } else {
                checkbox.checked = false;
                labelText.textContent = 'No prerelease builds for this selection';
                currentFilters.showPrereleases = false;
                if (wasShowingPrereleases) {
                    filterFirmware();
                    return;
                }
            }
        }

        async function loadFirmwareList() {
            try {
                setStatus('Loading firmware releases...', 'loading');
                
                const container = document.getElementById('firmwareContainer');
                container.innerHTML = '<div class="loading-spinner"></div> Loading...';
                
                // Get filtered packages (without type filter, since type comes from release tags now)
                const filteredPackages = packages.filter(pkg => {
                    const modelMatch = !currentFilters.deviceModel || pkg.device === currentFilters.deviceModel;
                    const softwareMatch = !currentFilters.software || pkg.name === currentFilters.software;
                    
                    return modelMatch && softwareMatch;
                });
                
                if (filteredPackages.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #6c757d;">No firmware found matching the selected filters</p>';
                    setStatus('No firmware found');
                    return;
                }
                
                // Group packages by repo to minimize API calls
                const repoGroups = {};
                filteredPackages.forEach(pkg => {
                    if (!repoGroups[pkg.repo]) {
                        repoGroups[pkg.repo] = [];
                    }
                    repoGroups[pkg.repo].push(pkg);
                });
                
                // Load releases for each unique repo (batch requests)
                const allReleases = [];
                const allReleasesBeforeFilter = [];  // Track all releases before filtering for prerelease detection
                
                const repoPromises = Object.keys(repoGroups).map(async (repo) => {
                    try {
                        const releases = await getReleases(repo);
                        releases.forEach(release => {
                            // Filter by type based on release tag name
                            if (!releaseMatchesTypeFilter(release.tag_name, currentFilters.deviceType)) {
                                return; // Skip this release if it doesn't match type filter
                            }
                            
                            // Add metadata for all packages that use this repo
                            repoGroups[repo].forEach(pkg => {
                                // Determine device type from tag name
                                const hasTypeB = release.tag_name.toLowerCase().includes('type-b') || 
                                                release.tag_name.toLowerCase().includes('-b-');
                                const deviceType = hasTypeB ? 'B' : 'A';
                                
                                const releaseWithMetadata = {
                                    ...release,
                                    software_name: pkg.name,
                                    device_type: deviceType,
                                    device_model: pkg.device
                                };
                                
                                // Add to all releases (for prerelease detection)
                                allReleasesBeforeFilter.push(releaseWithMetadata);
                                
                                // Check if this is a prerelease/nightly/beta
                                const tagLower = release.tag_name.toLowerCase();
                                // Releases with "stable" in tag name are always treated as stable, regardless of GitHub flag
                                const hasStableInTag = tagLower.includes('stable');
                                let isPrerelease = release.prerelease || release.draft || 
                                                   tagLower.includes('nightly') || 
                                                   tagLower.includes('beta');
                                // If tag contains "stable", override GitHub's pre-release flag and treat as stable
                                if (hasStableInTag) {
                                    isPrerelease = false;
                                }
                                
                                // Only add to display list if checkbox allows it
                                if (currentFilters.showPrereleases || !isPrerelease) {
                                    allReleases.push(releaseWithMetadata);
                                }
                            });
                        });
                    } catch (error) {
                        console.warn(`Failed to load releases for ${repo}:`, error);
                    }
                });
                
                // Wait for all repo requests to complete
                await Promise.all(repoPromises);
                
                // Sort releases by date (newest first)
                allReleases.sort((a, b) => new Date(b.published_at) - new Date(a.published_at));
                allReleasesBeforeFilter.sort((a, b) => new Date(b.published_at) - new Date(a.published_at));
                
                // Display releases (also checks for prereleases to show/hide checkbox)
                displayFirmwareList(allReleases, allReleasesBeforeFilter);
                setStatus(`Loaded ${allReleases.length} firmware releases`);
                
            } catch (error) {
                console.error('Error loading firmware list:', error);
                setStatus(`Error loading firmware: ${error.message}`, 'error');
                document.getElementById('firmwareContainer').innerHTML = 
                    '<p style="text-align: center; color: #c0392b;">Failed to load firmware list</p>';
            }
        }

        async function getReleases(repo) {
            try {
                // Fetch 100 releases to ensure stable releases are included even if they're older than pre-releases
                // This is important because if the first 30 releases are all pre-releases, stable releases won't be shown
                // Try unauthenticated API call first
                let response = await fetch(`https://api.github.com/repos/${repo}/releases?per_page=100`);
                
                // If rate limited and we have tokens, try with authentication
                if (response.status === 403 && apiTokens.length > 0) {
                    console.log(`Rate limited for ${repo}, trying with authentication...`);
                    const randomToken = apiTokens[Math.floor(Math.random() * apiTokens.length)];
                    response = await fetch(`https://api.github.com/repos/${repo}/releases?per_page=100`, {
                        headers: {
                            'Authorization': `token ${randomToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                }
                
                if (!response.ok) {
                    throw new Error(`GitHub API error: ${response.status}`);
                }
                
                const releases = await response.json();
                return releases
                    .filter(release => {
                        // Only include releases that have a rom.zip file
                        const hasRomZip = release.assets && release.assets.some(asset => 
                            asset.name && asset.name.toLowerCase() === 'rom.zip'
                        );
                        return hasRomZip;
                    })
                    .map(release => {
                        // Find the rom.zip asset and get its download count
                        const romZipAsset = release.assets.find(asset => 
                            asset.name && asset.name.toLowerCase() === 'rom.zip'
                        );
                        
                        // Find the update.zip asset if it exists
                        const updateZipAsset = release.assets.find(asset =>
                            asset.name && asset.name.toLowerCase() === 'update.zip'
                        );
                        
                        // Override: Releases with "stable" in tag name are always treated as stable
                        const tagLower = release.tag_name.toLowerCase();
                        const hasStableInTag = tagLower.includes('stable');
                        let isPrerelease = release.prerelease || false;
                        // If tag contains "stable", override GitHub's pre-release flag and treat as stable
                        if (hasStableInTag) {
                            isPrerelease = false;
                        }
                        
                        return {
                            tag_name: release.tag_name,
                            name: release.name || release.tag_name,
                            body: release.body || '',
                            published_at: release.published_at,
                            html_url: release.html_url,
                            assets: release.assets || [],
                            prerelease: isPrerelease, // Overridden if "stable" in tag
                            draft: release.draft || false,
                            download_count: romZipAsset ? romZipAsset.download_count : 0,
                            total_downloads: release.assets.reduce((sum, asset) => sum + (asset.download_count || 0), 0),
                            has_update_zip: !!updateZipAsset,
                            update_zip_url: updateZipAsset ? updateZipAsset.browser_download_url : null
                        };
                    });
            } catch (error) {
                console.warn(`Failed to fetch releases for ${repo}:`, error);
                return [];
            }
        }

        function displayFirmwareList(releases, allReleasesBeforeFilter = null) {
            const container = document.getElementById('firmwareContainer');
            
            if (releases.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d;">No releases found</p>';
                // Still check for prereleases even if filtered list is empty
                if (allReleasesBeforeFilter && allReleasesBeforeFilter.length > 0) {
                    const hasPreleases = allReleasesBeforeFilter.some(release => {
                        const tagLower = release.tag_name.toLowerCase();
                        // Releases with "stable" in tag name are always treated as stable
                        const hasStableInTag = tagLower.includes('stable');
                        let isPrerelease = release.prerelease || release.draft || 
                                           tagLower.includes('nightly') || 
                                           tagLower.includes('beta');
                        // If tag contains "stable", override GitHub's pre-release flag and treat as stable
                        if (hasStableInTag) {
                            isPrerelease = false;
                        }
                        return isPrerelease;
                    });
                    updatePrereleaseToggle(hasPreleases, allReleasesBeforeFilter);
                } else {
                    updatePrereleaseToggle(false);
                }
                return;
            }
            
            container.innerHTML = releases.map(release => {
                // Parse version designations
                const versionInfo = parseVersionDesignations(release.tag_name);
                const displayVersion = getDisplayVersion(versionInfo, release.published_at);
                const versionNeedsScrolling = displayVersion.length > 25;
                
                // Format download counts
                const formatDownloadCount = (count) => {
                    if (count >= 1000000) {
                        return (count / 1000000).toFixed(1) + 'M';
                    } else if (count >= 1000) {
                        return (count / 1000).toFixed(1) + 'K';
                    }
                    return count.toString();
                };
                
                // Generate pills HTML
                const fastUpdatePill = release.has_update_zip ? 
                    `<span class="fast-update-pill tooltip">âš¡ï¸ Fast Update<span class="tooltiptext" style="color: #fff;">Fast Updates can be installed without resetting your device's Bluetooth and Android settings. Install from <strong style="color: #ffd700;">Innioasis Updater</strong> (recommended for ease of use), this Firmware Directory website, or the GitHub release page.</span></span>` : '';
                
                const pillsHTML = versionInfo.designations.length > 0 || fastUpdatePill ? 
                    `<div class="version-pills">
                        ${fastUpdatePill}
                        ${versionInfo.designations.map(designation => 
                            `<span class="version-pill ${designation.type}">${designation.text}</span>`
                        ).join('')}
                    </div>` : '';
                
                // Add prerelease/draft indicator if applicable
                const prereleaseHTML = (release.prerelease || release.draft) ? 
                    `<span class="version-pill warning" style="background-color: #ff9500; color: white;">${release.draft ? 'Draft' : 'Prerelease'}</span>` : '';
                
                // Add software name detail
                const softwareHTML = `<div class="detail-item">
                    <div class="detail-label">Software</div>
                    <div class="detail-value">${release.software_name}</div>
                </div>`;
                
                // Only show released date if we're using version number as title
                const releasedDateHTML = versionInfo.cleanVersion.length <= 8 ? 
                    `<div class="detail-item">
                        <div class="detail-label">Released</div>
                        <div class="detail-value">${formatDate(release.published_at)}</div>
                    </div>` : '';
                
                return `
                    <div class="firmware-item" onclick="selectFirmware(this, '${release.software_name}')" data-release-body="${encodeURIComponent(release.body)}" data-release-name="${release.name || release.tag_name}">
                        <div class="firmware-name">${displayVersion}</div>
                        <div class="firmware-details">
                            ${softwareHTML}
                            ${prereleaseHTML ? `<div class="version-pills">${prereleaseHTML}</div>` : ''}
                            ${pillsHTML}
                            ${releasedDateHTML}
                            <div class="detail-item">
                                <div class="detail-label">Downloads</div>
                                <div class="detail-value">${formatDownloadCount(release.download_count || 0)}</div>
                            </div>
                            ${!currentFilters.deviceType ? `<div class="detail-item">
                                <div class="detail-label">Type</div>
                                <div class="detail-value">${release.device_type || 'N/A'}</div>
                            </div>` : ''}
                            ${!currentFilters.deviceModel ? `<div class="detail-item">
                                <div class="detail-label">Model</div>
                                <div class="detail-value">${release.device_model || 'N/A'}</div>
                            </div>` : ''}
                        </div>
                        <div class="download-section" style="flex-direction: column; gap: 8px;">
                            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                <button class="rom-download-btn" onclick="downloadRomZip('${release.assets.find(a => a.name.toLowerCase() === 'rom.zip')?.browser_download_url}', event)" style="flex: 1;">
                                    <div class="btn-title">ðŸ’¾ Download rom.zip</div>
                                    <div class="btn-subtitle">For <a href="https://innioasis.app/installguide.html" target="_blank" class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</a>, <a href="https://github.com/rockbox-y1/rockbox#spflash-tool" target="_blank" class="tool-link">SP Flash Tool</a>, and <a href="https://github.com/rockbox-y1/rockbox#mtkclient" target="_blank" class="tool-link">MTKClient</a></div>
                                </button>
                                ${release.has_update_zip ? `
                                    <button class="update-download-btn" onclick="downloadUpdateZip('${release.update_zip_url}', event)" style="flex: 1;">
                                        <div class="btn-title">ðŸ†• Download update.zip</div>
                                        <div class="btn-subtitle">Place in .rockbox folder on your Y1</div>
                                    </button>
                                ` : ''}
                                <button class="notes-btn" onclick="showReleaseNotes('${release.tag_name}', '${release.html_url.replace(/'/g, "\\'")}', event)" style="flex: 1;">
                                    ðŸ“– What's New
                                </button>
                            </div>
                            <div style="text-align: center; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border-secondary);">
                                <a href="https://innioasis.app/installguide.html" target="_blank" class="get-updater-link" onclick="event.stopPropagation()">
                                    ðŸ’¡ Install automatically with <span class="updater-with-icon"><img src="mtkclient/gui/images/icon.png" alt="">Updater</span>
                                </a>
                                <div class="methods-separator">
                                    <span>Other Methods</span>
                                </div>
                                <div class="installation-methods">
                                    <span class="method-link tooltip">ðŸ“± SP Flash Tool<span class="tooltiptext"><strong>Recommended:</strong> Use <strong>Innioasis Updater</strong> â€” it includes SP Flash Tool and automates everything. Launch from Updater's <strong>Toolkit</strong> or <strong>Settings</strong> menu.<br><br><strong>Manual Install:</strong><br>1. Download rom.zip above<br>2. Unpack the archive<br>3. Install <a href="https://spflashtool.com/download/" target="_blank">SP Flash Tool v5.1904</a><br>4. Get <a href="https://innioasis.app/DriverInstall.exe" target="_blank">driver</a> (if needed)<br>5. Reboot (if needed)<br>6. Start SP Flash Tool<br>7. Follow <a href="https://github.com/rockbox-y1/rockbox#spflash-tool" target="_blank">official instructions</a></span></span>
                                    <span class="method-link tooltip">ðŸ”§ MTKClient<span class="tooltiptext"><strong>Recommended:</strong> Use <strong>Innioasis Updater</strong> â€” it includes MTKClient and automates everything. Launch from Updater's <strong>Toolkit</strong> or <strong>Settings</strong> menu.<br><br><strong>Manual Install:</strong><br>1. Install <a href="https://github.com/bkerler/mtkclient" target="_blank">MTKClient</a><br>2. Download rom.zip above<br>3. Unpack: <code style="background: rgba(255,255,255,0.1); padding: 2px 4px; border-radius: 3px;">mkdir rom && cd rom && unzip ../rom.zip</code><br>4. Turn off device, disconnect from PC<br>5. Start flashing: <code style="background: rgba(255,255,255,0.1); padding: 2px 4px; border-radius: 3px;">python ../mtk.py w uboot,bootimg,recovery,android,usrdata lk.bin,boot.img,recovery.img,system.img,userdata.img</code><br>6. Connect device via USB<br>7. Unplug when finished<br>8. Power on device</span></span>
                                    ${release.has_update_zip ? `
                                    <span class="method-link" onclick="showBrowserInstallInstructions(event);" style="cursor: pointer;">ðŸŒ Install from Browser</span>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Check if any releases are prereleases/nightly/beta and show checkbox if needed
            // Use unfiltered list if provided, otherwise use displayed list
            const releasesToCheck = allReleasesBeforeFilter || releases;
            const hasPreleases = releasesToCheck.some(release => {
                const tagLower = release.tag_name.toLowerCase();
                // Releases with "stable" in tag name are always treated as stable
                const hasStableInTag = tagLower.includes('stable');
                let isPrerelease = release.prerelease || release.draft || 
                                   tagLower.includes('nightly') || 
                                   tagLower.includes('beta');
                // If tag contains "stable", override GitHub's pre-release flag and treat as stable
                if (hasStableInTag) {
                    isPrerelease = false;
                }
                return isPrerelease;
            });
            updatePrereleaseToggle(hasPreleases, releasesToCheck);
            
            // Add touch handling for scrolling text and check if scrolling is actually needed
            setTimeout(() => {
                document.querySelectorAll('.firmware-item').forEach(item => {
                    handleScrollingTextTouch(item);
                    checkAndAdjustScrolling(item);
                });
            }, 100);
        }

        function selectFirmware(element, softwareName) {
            // Remove previous selection
            document.querySelectorAll('.firmware-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selection to clicked item
            element.classList.add('selected');
        }

        // Handle touch interactions for scrolling text
        function handleScrollingTextTouch(element) {
            const scrollTexts = element.querySelectorAll('.scroll-text');
            scrollTexts.forEach(textElement => {
                textElement.addEventListener('touchstart', function() {
                    this.style.animationPlayState = 'paused';
                });
                
                textElement.addEventListener('touchend', function() {
                    setTimeout(() => {
                        this.style.animationPlayState = 'running';
                    }, 1000);
                });
            });
        }

        // Toggle scrolling animation
        function toggleScrollingAnimation(element) {
            const scrollTexts = element.querySelectorAll('.scroll-text');
            scrollTexts.forEach(textElement => {
                if (textElement.style.animationPlayState === 'paused') {
                    textElement.style.animationPlayState = 'running';
                } else {
                    textElement.style.animationPlayState = 'paused';
                }
            });
        }

        // Check if scrolling is actually needed based on element width
        function checkAndAdjustScrolling(element) {
            const scrollTexts = element.querySelectorAll('.scroll-text');
            scrollTexts.forEach(textElement => {
                // Temporarily remove scroll class to measure natural width
                const hasScrollClass = textElement.classList.contains('scroll-text');
                if (hasScrollClass) {
                    textElement.classList.remove('scroll-text');
                    textElement.style.whiteSpace = 'nowrap';
                    
                    const naturalWidth = textElement.scrollWidth;
                    const containerWidth = textElement.offsetWidth;
                    
                    // Only add scrolling if text is actually wider than container
                    if (naturalWidth > containerWidth + 10) { // 10px buffer
                        textElement.classList.add('scroll-text');
                    } else {
                        // Text fits, remove scrolling and restore normal wrapping
                        textElement.style.whiteSpace = 'normal';
                        textElement.style.maxWidth = 'none';
                    }
                }
            });
        }


        function goToInnioasisApp(event) {
            event.stopPropagation();
            
            // Direct users to the install guide for automatic installation
            window.open('https://innioasis.app', '_blank');
        }

        function goToGitHubRelease(releaseUrl, event) {
            event.stopPropagation();
            
            // Open the specific release page on GitHub in a new tab
            window.open(releaseUrl, '_blank');
        }

        function showBrowserInstallInstructions(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const instructions = `
                <div style="text-align: left; line-height: 1.8; position: relative;">
                    <button onclick="this.closest('.modal-overlay').remove()" style="position: absolute; top: -8px; right: -8px; background: #6c757d; color: white; border: none; border-radius: 50%; width: 32px; height: 32px; cursor: pointer; font-size: 18px; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;">Ã—</button>
                    <h3 style="margin-top: 0; color: #1d1d1f;">ðŸ“¥ Install from Browser</h3>
                    <p style="margin-bottom: 16px; color: #6c757d;">Follow these steps to install the update directly from your browser:</p>
                    
                    <ol style="padding-left: 20px; margin-bottom: 16px; color: #1d1d1f;">
                        <li style="margin-bottom: 12px;">Download <strong>update.zip</strong> using the button above</li>
                        <li style="margin-bottom: 12px;">Connect your Y1 to your computer via USB</li>
                        <li style="margin-bottom: 12px;">Navigate to your Y1's storage and place <strong>update.zip</strong> in the <code style="background: rgba(108, 117, 125, 0.1); padding: 2px 6px; border-radius: 3px;">.rockbox</code> folder</li>
                        <li style="margin-bottom: 12px;">Safely disconnect your Y1</li>
                        <li style="margin-bottom: 12px;">On your Y1, go to <strong>Main Menu > System > Firmware Update</strong></li>
                    </ol>
                    
                    <div style="background: rgba(255, 215, 0, 0.1); border-left: 3px solid #ffd700; padding: 12px; border-radius: 4px; margin-top: 16px;">
                        <strong style="color: #1d1d1f;">âš¡ï¸ Note:</strong> <span style="color: #3c3c3e;">This method only works if you already have a Fast Update compatible release installed on your Y1.</span>
                    </div>
                    
                    <div style="background: rgba(108, 117, 125, 0.05); border-left: 3px solid #6c757d; padding: 12px; border-radius: 4px; margin-top: 12px;">
                        <strong style="color: #1d1d1f;">ðŸ’¡ Tip:</strong> <span style="color: #3c3c3e;">For the easiest experience, we recommend using <a href="https://innioasis.app/installguide.html" target="_blank" style="color: #495057; font-weight: 600; text-decoration: underline;">Innioasis Updater</a> which automates this entire process.</span>
                    </div>
                </div>
            `;
            
            // Create a modal-like display
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000; padding: 20px;';
            modal.onclick = () => modal.remove();
            
            const content = document.createElement('div');
            content.style.cssText = 'background: white; border-radius: 12px; padding: 24px; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 8px 32px rgba(0,0,0,0.3); position: relative;';
            content.onclick = (e) => e.stopPropagation();
            content.innerHTML = instructions;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
        }

        function showReleaseNotes(tagName, htmlUrl, event) {
            event.stopPropagation();
            
            // Find the firmware item that was clicked
            const firmwareItem = event.target.closest('.firmware-item');
            if (!firmwareItem) {
                console.error('Could not find firmware item');
                return;
            }
            
            // Get release body from data attribute
            const releaseBody = decodeURIComponent(firmwareItem.dataset.releaseBody || '');
            const releaseName = firmwareItem.dataset.releaseName || tagName;
            
            // Check if notes are already shown for this item
            let notesContainer = firmwareItem.querySelector('.release-notes-container');
            
            if (notesContainer) {
                // Toggle visibility
                if (notesContainer.style.display === 'none') {
                    notesContainer.style.display = 'block';
                } else {
                    notesContainer.style.display = 'none';
                }
            } else {
                // Create and show notes container
                notesContainer = document.createElement('div');
                notesContainer.className = 'release-notes-container';
                notesContainer.style.marginTop = '15px';
                notesContainer.style.padding = '15px';
                notesContainer.style.background = 'var(--bg-tertiary)';
                notesContainer.style.borderRadius = '8px';
                notesContainer.style.border = '1px solid var(--border-primary)';
                notesContainer.style.maxHeight = '400px';
                notesContainer.style.overflowY = 'auto';
                
                // Parse markdown to basic HTML
                const notesHTML = releaseBody ? parseMarkdownToHTML(releaseBody) : '<p style="color: #6c757d; font-style: italic;">No release notes available</p>';
                
                notesContainer.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; border-bottom: 1px solid var(--border-primary); padding-bottom: 10px;">
                        <h4 style="margin: 0; color: var(--text-primary);">What's New in ${releaseName}</h4>
                        <div>
                            <button onclick="window.open('${htmlUrl}', '_blank')" style="background: var(--accent-primary); color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; margin-right: 8px; font-size: 0.8rem;">View on GitHub</button>
                            <button onclick="this.closest('.release-notes-container').style.display='none'" style="background: #6c757d; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">Close</button>
                        </div>
                    </div>
                    <div class="release-notes-content" style="color: var(--text-primary); line-height: 1.6;">
                        ${notesHTML}
                    </div>
                `;
                
                firmwareItem.appendChild(notesContainer);
            }
        }

        function parseMarkdownToHTML(markdown) {
            // Simple markdown parser for basic formatting
            let html = markdown;
            
            // Convert headers
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
            
            // Convert bold
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Convert italic
            html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // Convert code blocks
            html = html.replace(/```(.*?)```/gs, '<pre style="background: var(--bg-tertiary); padding: 10px; border-radius: 4px; overflow-x: auto;"><code>$1</code></pre>');
            
            // Convert inline code
            html = html.replace(/`(.*?)`/g, '<code style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 3px;">$1</code>');
            
            // Convert links
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color: var(--accent-primary); text-decoration: none;">$1</a>');
            
            // Convert line breaks to paragraphs
            html = html.split('\n\n').map(para => para.trim() ? `<p style="margin-bottom: 12px;">${para.replace(/\n/g, '<br>')}</p>` : '').join('');
            
            return html;
        }

        function downloadRomZip(romZipUrl, event) {
            event.stopPropagation();
            
            // Create download link
            const link = document.createElement('a');
            link.href = romZipUrl;
            link.download = 'rom.zip';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show brief success message
            setTimeout(() => {
                setStatus('rom.zip download started! Use with Updater, SP Flash Tool, or MTKClient.', 'success');
            }, 500);
        }

        function downloadUpdateZip(updateZipUrl, event) {
            event.stopPropagation();
            
            // Get the currently selected software name from the dropdown
            const softwareSelect = document.getElementById('software');
            const softwareName = softwareSelect.options[softwareSelect.selectedIndex]?.text || 'this firmware';
            
            // Create download link
            const link = document.createElement('a');
            link.href = updateZipUrl;
            link.download = 'update.zip';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show instructions after download starts
            setTimeout(() => {
                alert('âš ï¸ IMPORTANT - PLEASE READ:\n\n' +
                      'If this is the FIRST TIME you install ' + softwareName + ' on your Y1, if you don\'t see the Firmware Update option in Main Menu > System, you\'ll need to use a tool like Updater (+ SP Flash Tool or MTKClient) to do this update the first time.\n\n' +
                      'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n' +
                      'ðŸ“¥ Installation Instructions:\n\n' +
                      '1. Connect your Y1 in USB Mode and copy update.zip to .rockbox/update.zip\n\n' +
                      '2. Safely disconnect your Y1\n\n' +
                      '3. Go to Main Menu > System and click Firmware Update\n\n' +
                      '4. The update process will now run in the background and automatically restart the device once it is done');
                
                setStatus('update.zip download started! Check your Downloads folder.', 'success');
            }, 500);
        }

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return formatFancyDate(date);
            } catch (error) {
                return dateString;
            }
        }

        function setStatus(message, type = '') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        function refreshData() {
            loadData();
        }

        // Handle errors gracefully
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.error);
            setStatus('An unexpected error occurred', 'error');
        });

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            setStatus('Network or API error occurred', 'error');
        });

        // macOS Step Navigation Functions
        function downloadMacDMG() {
            // Download macOS DMG installer
            const url = 'https://github.com/y1-community/Innioasis-Updater/releases/latest/download/Innioasis.Updater.for.Mac.dmg';
            
            // For Safari, open in new tab, for other browsers use download attribute
            if (navigator.userAgent.includes('Safari') && !navigator.userAgent.includes('Chrome')) {
                window.open(url, '_blank');
                setTimeout(() => {
                    alert('ðŸŽ‰ Opening download page in new tab! Click the download button on the GitHub page.');
                }, 1000);
            } else {
                const link = document.createElement('a');
                link.href = url;
                link.download = 'Innioasis.Updater.for.Mac.dmg';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                setTimeout(() => {
                    alert('ðŸŽ‰ Download started! The DMG file is downloading to your Downloads folder.');
                }, 1000);
            }
            
            // Auto-advance to next step after a short delay
            setTimeout(() => {
                nextMacStep();
            }, 1500);
        }

        function nextMacStep() {
            const currentStep = getCurrentMacStep();
            if (currentStep < 3) {
                hideMacStep(currentStep);
                showMacStep(currentStep + 1);
                updateAppleGuideLink();
            }
        }

        function prevMacStep() {
            const currentStep = getCurrentMacStep();
            if (currentStep > 1) {
                hideMacStep(currentStep);
                showMacStep(currentStep - 1);
            }
        }

        function getCurrentMacStep() {
            for (let i = 1; i <= 3; i++) {
                if (document.getElementById(`macStep${i}`).style.display !== 'none') {
                    return i;
                }
            }
            return 1;
        }

        function showMacStep(stepNumber) {
            document.getElementById(`macStep${stepNumber}`).style.display = 'block';
        }

        function hideMacStep(stepNumber) {
            document.getElementById(`macStep${stepNumber}`).style.display = 'none';
        }

        function updateAppleGuideLink() {
            // Get macOS version and update the Apple guide link
            const userAgent = navigator.userAgent;
            let macVersion = '14.0'; // Default to macOS 14
            
            if (userAgent.includes('Mac OS X 10_15')) {
                macVersion = '10.15'; // macOS Catalina
            } else if (userAgent.includes('Mac OS X 11_')) {
                macVersion = '11.0'; // macOS Big Sur
            } else if (userAgent.includes('Mac OS X 12_')) {
                macVersion = '12.0'; // macOS Monterey
            } else if (userAgent.includes('Mac OS X 13_')) {
                macVersion = '13.0'; // macOS Ventura
            } else if (userAgent.includes('Mac OS X 14_')) {
                macVersion = '14.0'; // macOS Sonoma
            } else if (userAgent.includes('Mac OS X 15_')) {
                macVersion = '15.0'; // macOS Sequoia
            }
            
            const appleGuideLink = document.getElementById('appleGuideLink');
            if (appleGuideLink) {
                appleGuideLink.href = `https://support.apple.com/en-gb/guide/mac-help/mh40616/${macVersion}/mac/${macVersion}`;
            }
        }

        function showMacTerminalInstall() {
            // Show terminal installation method
            const terminalDialog = document.createElement('div');
            terminalDialog.className = 'platform-dialog show';
            terminalDialog.innerHTML = `
                <h3>ðŸŽ App not working?</h3>
                <p>Try running this command in Terminal:</p>
                <div class="command-display">
                    <code>curl -fsSL https://mac.innioasis.app | bash</code>
                </div>
                <button class="btn" onclick="copyMacCommand()">ðŸ“‹ Copy Command</button>
                <button class="btn btn-secondary" onclick="closeTerminalDialog()">Close</button>
            `;
            
            document.body.appendChild(terminalDialog);
            document.getElementById('dialogOverlay').classList.add('show');
        }

        function closeTerminalDialog() {
            const terminalDialog = document.querySelector('.platform-dialog.show:not(#macDialog)');
            if (terminalDialog) {
                terminalDialog.remove();
            }
            document.getElementById('dialogOverlay').classList.remove('show');
        }

        // Navigate between platform dialogs
        function navigateToPlatform(dialogId) {
            // Close the platform guides dialog
            closeDialog();
            // Show the selected platform dialog
            setTimeout(() => {
                showDialog(dialogId);
            }, 100);
        }

        // Windows Step Navigation Functions
        function nextWindowsStep() {
            const currentStep = getCurrentWindowsStep();
            if (currentStep < 3) {
                hideWindowsStep(currentStep);
                showWindowsStep(currentStep + 1);
            }
        }

        function prevWindowsStep() {
            const currentStep = getCurrentWindowsStep();
            if (currentStep > 1) {
                hideWindowsStep(currentStep);
                showWindowsStep(currentStep - 1);
            }
        }

        function getCurrentWindowsStep() {
            for (let i = 1; i <= 3; i++) {
                if (document.getElementById(`windowsStep${i}`).style.display !== 'none') {
                    return i;
                }
            }
            return 1;
        }

        function showWindowsStep(stepNumber) {
            document.getElementById(`windowsStep${stepNumber}`).style.display = 'block';
        }

        function hideWindowsStep(stepNumber) {
            document.getElementById(`windowsStep${stepNumber}`).style.display = 'none';
        }

        // Theme toggle functionality - cycles through Auto â†’ Light â†’ Dark
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            const icon = themeToggle.querySelector('.icon');
            const text = themeToggle.querySelector('span:not(.icon)');
            const currentTheme = localStorage.getItem('theme') || 'auto';
            
            let newTheme;
            if (currentTheme === 'auto') {
                newTheme = 'light';
            } else if (currentTheme === 'light') {
                newTheme = 'dark';
            } else {
                newTheme = 'auto';
            }
            
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme);
        }

        // Apply the specified theme
        function applyTheme(theme) {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            const icon = themeToggle.querySelector('.icon');
            const text = themeToggle.querySelector('span:not(.icon)');
            
            if (theme === 'auto') {
                // Check system preference
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    body.setAttribute('data-theme', 'dark');
                    icon.textContent = 'ðŸŒ“';
                    text.textContent = 'Auto';
                } else {
                    body.removeAttribute('data-theme');
                    icon.textContent = 'ðŸŒ“';
                    text.textContent = 'Auto';
                }
            } else if (theme === 'dark') {
                body.setAttribute('data-theme', 'dark');
                icon.textContent = 'â˜€ï¸';
                text.textContent = 'Light';
            } else {
                body.removeAttribute('data-theme');
                icon.textContent = 'ðŸŒ™';
                text.textContent = 'Dark';
            }
        }

        // Check saved theme preference and system theme
        function checkSavedTheme() {
            const savedTheme = localStorage.getItem('theme') || 'auto';
            applyTheme(savedTheme);
            
            // Listen for system theme changes when in auto mode
            if (savedTheme === 'auto') {
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                    if (localStorage.getItem('theme') === 'auto') {
                        if (e.matches) {
                            document.body.setAttribute('data-theme', 'dark');
                        } else {
                            document.body.removeAttribute('data-theme');
                        }
                    }
                });
            }
        }
    </script>

    <!-- Neomorphic Floating Support Us Toolbar - Horizontal Pills with Expandable Donate -->
    <div id="support-toolbar-container">
        <style>
            #support-toolbar {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 10000;
                display: flex;
                gap: 10px;
                align-items: center;
                font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
                background: #f0f0f3;
                padding: 8px 12px;
                border-radius: 50px;
                box-shadow: 
                    8px 8px 16px rgba(163, 177, 198, 0.6),
                    -8px -8px 16px rgba(255, 255, 255, 0.5);
                transition: all 0.3s ease;
                flex-wrap: wrap;
                max-width: calc(100vw - 40px);
            }

            .support-toolbar-btn {
                background: #f0f0f3;
                border: none;
                border-radius: 25px;
                padding: 10px 18px;
                cursor: pointer;
                font-size: 13px;
                font-weight: 600;
                color: #2d2d2d;
                text-decoration: none;
                display: flex;
                align-items: center;
                gap: 8px;
                box-shadow: 
                    4px 4px 8px rgba(163, 177, 198, 0.6),
                    -4px -4px 8px rgba(255, 255, 255, 0.5);
                transition: all 0.3s ease;
                white-space: nowrap;
            }

            .support-toolbar-btn:hover {
                box-shadow: 
                    2px 2px 4px rgba(163, 177, 198, 0.6),
                    -2px -2px 4px rgba(255, 255, 255, 0.5);
                transform: translateY(-1px);
            }

            .support-toolbar-btn:active {
                box-shadow: 
                    inset 2px 2px 4px rgba(163, 177, 198, 0.6),
                    inset -2px -2px 4px rgba(255, 255, 255, 0.5);
                transform: translateY(0);
            }

            .support-toolbar-btn.primary {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                box-shadow: 
                    4px 4px 8px rgba(102, 126, 234, 0.4),
                    -4px -4px 8px rgba(118, 75, 162, 0.3);
            }

            .support-toolbar-btn.primary:hover {
                box-shadow: 
                    2px 2px 4px rgba(102, 126, 234, 0.4),
                    -2px -2px 4px rgba(118, 75, 162, 0.3);
            }

            .support-toolbar-icon {
                font-size: 16px;
                display: inline-block;
                line-height: 1;
            }

            #donate-options {
                display: none;
                gap: 10px;
                align-items: center;
                flex-wrap: wrap;
            }

            #donate-options.expanded {
                display: flex;
            }

            .crypto-address {
                display: flex;
                flex-direction: column;
                gap: 4px;
                padding: 8px 12px;
                background: #f0f0f3;
                border-radius: 12px;
                box-shadow: 
                    2px 2px 4px rgba(163, 177, 198, 0.6),
                    -2px -2px 4px rgba(255, 255, 255, 0.5);
                min-width: 140px;
            }

            .crypto-label {
                font-size: 11px;
                font-weight: 700;
                color: #667eea;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                display: flex;
                align-items: center;
                gap: 6px;
            }

            .crypto-copy-hint {
                font-size: 9px;
                font-weight: 400;
                color: #86868b;
                text-transform: none;
                letter-spacing: 0;
            }

            .crypto-code {
                font-size: 10px;
                font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
                color: #2d2d2d;
                word-break: break-all;
                cursor: pointer;
                padding: 4px 6px;
                background: rgba(0, 0, 0, 0.05);
                border-radius: 6px;
                transition: all 0.2s ease;
            }

            .crypto-code:hover {
                background: rgba(0, 0, 0, 0.1);
            }

            .crypto-code.copied {
                background: rgba(34, 197, 94, 0.2);
                color: #22c55e;
            }

            @media (max-width: 768px) {
                #support-toolbar {
                    bottom: 15px;
                    right: 15px;
                    left: 15px;
                    justify-content: center;
                    padding: 6px 10px;
                    gap: 8px;
                    border-radius: 25px;
                }

                .support-toolbar-btn {
                    padding: 8px 14px;
                    font-size: 12px;
                }

                .support-toolbar-icon {
                    font-size: 16px;
                }

                .crypto-address {
                    min-width: 120px;
                    padding: 6px 10px;
                }

                .crypto-code {
                    font-size: 9px;
                }
            }

            /* Dark mode support */
            @media (prefers-color-scheme: dark) {
                #support-toolbar {
                    background: #2d2d2d;
                    box-shadow: 
                        8px 8px 16px rgba(0, 0, 0, 0.4),
                        -8px -8px 16px rgba(60, 60, 60, 0.3);
                }

                .support-toolbar-btn {
                    background: #2d2d2d;
                    color: #e0e0e0;
                    box-shadow: 
                        4px 4px 8px rgba(0, 0, 0, 0.4),
                        -4px -4px 8px rgba(60, 60, 60, 0.3);
                }

                .support-toolbar-btn:hover {
                    box-shadow: 
                        2px 2px 4px rgba(0, 0, 0, 0.4),
                        -2px -2px 4px rgba(60, 60, 60, 0.3);
                }

                .support-toolbar-btn:active {
                    box-shadow: 
                        inset 2px 2px 4px rgba(0, 0, 0, 0.4),
                        inset -2px -2px 4px rgba(60, 60, 60, 0.3);
                }

                .crypto-address {
                    background: #2d2d2d;
                    box-shadow: 
                        2px 2px 4px rgba(0, 0, 0, 0.4),
                        -2px -2px 4px rgba(60, 60, 60, 0.3);
                }

                .crypto-code {
                    color: #e0e0e0;
                    background: rgba(255, 255, 255, 0.05);
                }

                .crypto-code:hover {
                    background: rgba(255, 255, 255, 0.1);
                }

                .crypto-copy-hint {
                    color: #a0a0a0;
                }
            }

            body[data-theme="dark"] #support-toolbar {
                background: #2d2d2d;
                box-shadow: 
                    8px 8px 16px rgba(0, 0, 0, 0.4),
                    -8px -8px 16px rgba(60, 60, 60, 0.3);
            }

            body[data-theme="dark"] .support-toolbar-btn {
                background: #2d2d2d;
                color: #e0e0e0;
                box-shadow: 
                    4px 4px 8px rgba(0, 0, 0, 0.4),
                    -4px -4px 8px rgba(60, 60, 60, 0.3);
            }

            body[data-theme="dark"] .support-toolbar-btn:hover {
                box-shadow: 
                    2px 2px 4px rgba(0, 0, 0, 0.4),
                    -2px -2px 4px rgba(60, 60, 60, 0.3);
            }

            body[data-theme="dark"] .support-toolbar-btn:active {
                box-shadow: 
                    inset 2px 2px 4px rgba(0, 0, 0, 0.4),
                    inset -2px -2px 4px rgba(60, 60, 60, 0.3);
            }

            body[data-theme="dark"] .crypto-address {
                background: #2d2d2d;
                box-shadow: 
                    2px 2px 4px rgba(0, 0, 0, 0.4),
                    -2px -2px 4px rgba(60, 60, 60, 0.3);
            }

            body[data-theme="dark"] .crypto-code {
                color: #e0e0e0;
                background: rgba(255, 255, 255, 0.05);
            }

            body[data-theme="dark"] .crypto-code:hover {
                background: rgba(255, 255, 255, 0.1);
            }

            body[data-theme="dark"] .crypto-copy-hint {
                color: #a0a0a0;
            }
        </style>
        <div id="support-toolbar">
            <a href="https://www.innioasis.app/support_devs.html" class="support-toolbar-btn primary" target="_blank" rel="noopener noreferrer">
                <span class="support-toolbar-icon">ðŸ’™</span>
                <span>Support Development</span>
            </a>
            <button id="donate-toggle" class="support-toolbar-btn" type="button">
                <span class="support-toolbar-icon">ðŸ’³</span>
                <span>Donate</span>
            </button>
            <div id="donate-options">
                <a href="https://revolut.me/rspecter" class="support-toolbar-btn" target="_blank" rel="noopener noreferrer">
                    <span class="support-toolbar-icon">ðŸ’¸</span>
                    <span>Revolut</span>
                </a>
                <a href="https://ko-fi.com/teamslide" class="support-toolbar-btn" target="_blank" rel="noopener noreferrer">
                    <span class="support-toolbar-icon">â˜•</span>
                    <span>Ko-fi</span>
                </a>
                <a href="https://paypal.me/respectyarn" class="support-toolbar-btn" target="_blank" rel="noopener noreferrer">
                    <span class="support-toolbar-icon">ðŸ’³</span>
                    <span>PayPal</span>
                </a>
                <div class="crypto-address">
                    <span class="crypto-label">
                        Bitcoin
                        <span class="crypto-copy-hint">(click to copy)</span>
                    </span>
                    <code class="crypto-code" id="btc-address" onclick="copyCryptoAddress('bc1q9vsjqjr6pjuc3vrgverx0v9ydst8s82ck4kpue', 'btc-address')" title="Click to copy">bc1q9vsjqjr6pjuc3vrgverx0v9ydst8s82ck4kpue</code>
                </div>
                <div class="crypto-address">
                    <span class="crypto-label">
                        Ethereum
                        <span class="crypto-copy-hint">(click to copy)</span>
                    </span>
                    <code class="crypto-code" id="eth-address" onclick="copyCryptoAddress('0x3eec22630ca9fd77D22d362bF6C50dE29D3B84c4', 'eth-address')" title="Click to copy">0x3eec22630ca9fd77D22d362bF6C50dE29D3B84c4</code>
                </div>
            </div>
        </div>
        <script>
            (function() {
                const donateToggle = document.getElementById('donate-toggle');
                const donateOptions = document.getElementById('donate-options');
                
                if (donateToggle && donateOptions) {
                    donateToggle.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        donateOptions.classList.toggle('expanded');
                    });

                    // Close when clicking outside
                    document.addEventListener('click', function(e) {
                        if (!e.target.closest('#support-toolbar-container')) {
                            donateOptions.classList.remove('expanded');
                        }
                    });

                    function copyCryptoAddress(address, elementId) {
                        navigator.clipboard.writeText(address).then(function() {
                            const element = document.getElementById(elementId);
                            const originalText = element.textContent;
                            element.textContent = 'Copied!';
                            element.classList.add('copied');
                            setTimeout(function() {
                                element.textContent = originalText;
                                element.classList.remove('copied');
                            }, 2000);
                        }).catch(function(err) {
                            console.error('Failed to copy: ', err);
                            alert('Failed to copy to clipboard. Please copy manually: ' + address);
                        });
                    }

                    // Make copyCryptoAddress available globally
                    window.copyCryptoAddress = copyCryptoAddress;
                }
            })();
        </script>
    </div>
</body>
</html>
